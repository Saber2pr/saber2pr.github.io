var version="2026/1/25 13:14:30";(self.webpackChunksaber2pr_github_io=self.webpackChunksaber2pr_github_io||[]).push([[953],{32687:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{MessagePrimitiveAttachments:()=>g}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(7509),l=r(76065),d=r(34563),p=r(73915),h=r(33823),m=({components:e})=>{const t=(0,d.useMessageAttachment)((t=>((e,t)=>{const r=t.type;switch(r){case"image":return e?.Image??e?.Attachment;case"document":return e?.Document??e?.Attachment;case"file":return e?.File??e?.Attachment;default:throw new Error(`Unknown attachment type: ${r}`)}})(e,t)));return t?(0,h.jsx)(t,{}):null},f=(0,u.memo)((({components:e,attachmentIndex:t})=>{const r=(0,l.useMessageRuntime)(),s=(0,u.useMemo)((()=>r.getAttachmentByIndex(t)),[r,t]);return(0,h.jsx)(p.AttachmentRuntimeProvider,{runtime:s,children:(0,h.jsx)(m,{components:e})})}),((e,t)=>e.attachmentIndex===t.attachmentIndex&&e.components?.Image===t.components?.Image&&e.components?.Document===t.components?.Document&&e.components?.File===t.components?.File&&e.components?.Attachment===t.components?.Attachment)),g=({components:e})=>{const t=(0,l.useMessage)((e=>"user"!==e.role?0:e.attachments.length));return Array.from({length:t},((t,r)=>(0,h.jsx)(f,{attachmentIndex:r,components:e},r)))};g.displayName="MessagePrimitive.Attachments"},58966:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{MessagePrimitiveContent:()=>P}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(7509),l=r(76065),d=r(60546),p=r(86190),h=r(12431),m=r(54843),f=r(4415),g=r(33823),b=({Fallback:e,...t})=>{const r=(0,l.useToolUIs)((e=>e.getToolUI(t.toolName)))??e;return r?(0,g.jsx)(r,{...t}):null},y={Text:()=>(0,g.jsxs)("p",{style:{whiteSpace:"pre-line"},children:[(0,g.jsx)(h.ContentPartPrimitiveText,{}),(0,g.jsx)(f.ContentPartPrimitiveInProgress,{children:(0,g.jsx)("span",{style:{fontFamily:"revert"},children:" â—"})})]}),Reasoning:()=>null,Source:()=>null,Image:()=>(0,g.jsx)(m.ContentPartPrimitiveImage,{}),File:()=>null,Unstable_Audio:()=>null},O=({components:{Text:e=y.Text,Reasoning:t=y.Reasoning,Image:r=y.Image,Source:s=y.Source,File:o=y.File,Unstable_Audio:n=y.Unstable_Audio,tools:a={}}={}})=>{const i=(0,l.useContentPartRuntime)(),c=(0,l.useContentPart)(),u=c.type;if("tool-call"===u){const e=e=>i.addToolResult(e);if("Override"in a)return(0,g.jsx)(a.Override,{...c,addResult:e});const t=a.by_name?.[c.toolName]??a.Fallback;return(0,g.jsx)(b,{...c,Fallback:t,addResult:e})}if("requires-action"===c.status.type)throw new Error("Encountered unexpected requires-action status");switch(u){case"text":return(0,g.jsx)(e,{...c});case"reasoning":return(0,g.jsx)(t,{...c});case"source":return(0,g.jsx)(s,{...c});case"image":return(0,g.jsx)(r,{...c});case"file":return(0,g.jsx)(o,{...c});case"audio":return(0,g.jsx)(n,{...c});default:throw new Error(`Unknown content part type: ${u}`)}},w=(0,u.memo)((({partIndex:e,components:t})=>{const r=(0,d.useMessageRuntime)(),s=(0,u.useMemo)((()=>r.getContentPartByIndex(e)),[r,e]);return(0,g.jsx)(p.ContentPartRuntimeProvider,{runtime:s,children:(0,g.jsx)(O,{components:t})})}),((e,t)=>e.partIndex===t.partIndex&&e.components?.Text===t.components?.Text&&e.components?.Reasoning===t.components?.Reasoning&&e.components?.Source===t.components?.Source&&e.components?.Image===t.components?.Image&&e.components?.File===t.components?.File&&e.components?.Unstable_Audio===t.components?.Unstable_Audio&&e.components?.tools===t.components?.tools)),v=Object.freeze({type:"complete"}),_=({status:e,component:t})=>(0,g.jsx)(l.TextContentPartProvider,{text:"",isRunning:"running"===e.type,children:(0,g.jsx)(t,{type:"text",text:"",status:e})}),j=(0,u.memo)((({components:e})=>{const t=(0,d.useMessage)((e=>e.status))??v;return e?.Empty?(0,g.jsx)(e.Empty,{status:t}):(0,g.jsx)(_,{status:t,component:e?.Text??y.Text})}),((e,t)=>e.components?.Empty===t.components?.Empty&&e.components?.Text===t.components?.Text)),P=({components:e})=>{const t=(0,d.useMessage)((e=>e.content.length));return 0===t?(0,g.jsx)(j,{components:e}):Array.from({length:t},((t,r)=>(0,g.jsx)(w,{partIndex:r,components:e},r)))};P.displayName="MessagePrimitive.Content"},95034:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{MessagePrimitiveIf:()=>d}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(60546),l=r(24967),d=({children:e,...t})=>(e=>{const t=(0,u.useMessageRuntime)(),r=(0,u.useMessageUtilsStore)();return(0,l.useCombinedStore)([t,r],(({role:t,attachments:r,content:s,branchCount:o,isLast:n,speech:a,submittedFeedback:i},{isCopied:c,isHovering:u})=>!(!0===e.hasBranches&&o<2||e.user&&"user"!==t||e.assistant&&"assistant"!==t||e.system&&"system"!==t||!0===e.lastOrHover&&!u&&!n||!0===e.copied&&!c||!1===e.copied&&c||!0===e.speaking&&null==a||!1===e.speaking&&null!=a||!(!0!==e.hasAttachments||"user"===t&&r.length)||!1===e.hasAttachments&&"user"===t&&r.length||!0===e.hasContent&&0===s.length||!1===e.hasContent&&s.length>0||void 0!==e.submittedFeedback&&(i?.type??null)!==e.submittedFeedback)))})(t)?e:null;d.displayName="MessagePrimitive.If"},94776:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{MessagePrimitiveRoot:()=>f}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(37767),l=r(7509),d=r(60546),p=r(48714),h=r(34631),m=r(33823),f=(0,l.forwardRef)(((e,t)=>{const r=(()=>{const e=(0,d.useMessageUtilsStore)(),t=(0,l.useCallback)((t=>{const r=e.getState().setIsHovering,s=()=>{r(!0)},o=()=>{r(!1)};return t.addEventListener("mouseenter",s),t.addEventListener("mouseleave",o),()=>{t.removeEventListener("mouseenter",s),t.removeEventListener("mouseleave",o),r(!1)}}),[e]);return(0,p.useManagedRef)(t)})(),s=(0,h.useComposedRefs)(t,r);return(0,m.jsx)(u.Primitive.div,{...e,ref:s})}));f.displayName="MessagePrimitive.Root"},97960:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{Attachments:()=>p.MessagePrimitiveAttachments,Content:()=>d.MessagePrimitiveContent,If:()=>l.MessagePrimitiveIf,Root:()=>u.MessagePrimitiveRoot}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(94776),l=r(95034),d=r(58966),p=r(32687)},76373:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{ThreadPrimitiveEmpty:()=>l}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(76065),l=({children:e})=>(0,u.useThread)((e=>0===e.messages.length))?e:null;l.displayName="ThreadPrimitive.Empty"},47887:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{ThreadPrimitiveIf:()=>l}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(76065),l=({children:e,...t})=>{var r;return r=t,(0,u.useThread)((e=>!(!0===r.empty&&0!==e.messages.length||!1===r.empty&&0===e.messages.length||!0===r.running&&!e.isRunning||!1===r.running&&e.isRunning||!0===r.disabled&&!e.isDisabled||!1===r.disabled&&e.isDisabled)))?e:null};l.displayName="ThreadPrimitive.If"},89341:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{ThreadPrimitiveMessages:()=>O,ThreadPrimitiveMessagesImpl:()=>y}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(7509),l=r(64426),d=r(36792),p=r(76065),h=r(33823),m=(e,t)=>e.Message===t.Message&&e.EditComposer===t.EditComposer&&e.UserEditComposer===t.UserEditComposer&&e.AssistantEditComposer===t.AssistantEditComposer&&e.SystemEditComposer===t.SystemEditComposer&&e.UserMessage===t.UserMessage&&e.AssistantMessage===t.AssistantMessage&&e.SystemMessage===t.SystemMessage,f=()=>null,g=({components:e})=>{const t=((e,t,r)=>{switch(t){case"user":return r?e.UserEditComposer??e.EditComposer??e.UserMessage??e.Message:e.UserMessage??e.Message;case"assistant":return r?e.AssistantEditComposer??e.EditComposer??e.AssistantMessage??e.Message:e.AssistantMessage??e.Message;case"system":return r?e.SystemEditComposer??e.EditComposer??e.SystemMessage??e.Message:e.SystemMessage??f;default:throw new Error(`Unknown message role: ${t}`)}})(e,(0,p.useMessage)((e=>e.role)),(0,p.useEditComposer)((e=>e.isEditing)));return(0,h.jsx)(t,{})},b=(0,u.memo)((({messageIndex:e,components:t})=>{const r=(0,l.useThreadRuntime)(),s=(0,u.useMemo)((()=>r.getMesssageByIndex(e)),[r,e]);return(0,h.jsx)(d.MessageRuntimeProvider,{runtime:s,children:(0,h.jsx)(g,{components:t})})}),((e,t)=>e.messageIndex===t.messageIndex&&m(e.components,t.components))),y=({components:e})=>{const t=(0,l.useThread)((e=>e.messages.length));return 0===t?null:Array.from({length:t},((t,r)=>(0,h.jsx)(b,{messageIndex:r,components:e},r)))};y.displayName="ThreadPrimitive.Messages";var O=(0,u.memo)(y,((e,t)=>m(e.components,t.components)))},61445:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{ThreadPrimitiveRoot:()=>p}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(37767),l=r(7509),d=r(33823),p=(0,l.forwardRef)(((e,t)=>(0,d.jsx)(u.Primitive.div,{...e,ref:t})));p.displayName="ThreadPrimitive.Root"},28204:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{ThreadPrimitiveScrollToBottom:()=>p}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(93187),l=r(7509),d=r(89429),p=(0,u.createActionButton)("ThreadPrimitive.ScrollToBottom",(()=>{const e=(0,d.useThreadViewport)((e=>e.isAtBottom)),t=(0,d.useThreadViewportStore)(),r=(0,l.useCallback)((()=>{t.getState().scrollToBottom()}),[t]);return e?null:r}))},49664:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{ThreadPrimitiveSuggestion:()=>h}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(93187),l=r(7509),d=r(76065),p=r(64426),h=(0,u.createActionButton)("ThreadPrimitive.Suggestion",(({prompt:e,autoSend:t})=>{const r=(0,p.useThreadRuntime)(),s=(0,d.useThread)((e=>e.isDisabled)),o=(0,l.useCallback)((()=>{t&&!r.getState().isRunning?r.append(e):r.composer.setText(e)}),[r,t,e]);return s?null:o}),["prompt","autoSend","method"])},37103:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{ThreadPrimitiveViewport:()=>g}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(34631),l=r(37767),d=r(7509),p=r(88313),h=r(41161),m=r(33823),f=(0,d.forwardRef)((({autoScroll:e,children:t,...r},s)=>{const o=(0,p.useThreadViewportAutoScroll)({autoScroll:e}),n=(0,u.useComposedRefs)(s,o);return(0,m.jsx)(l.Primitive.div,{...r,ref:n,children:t})}));f.displayName="ThreadPrimitive.ViewportScrollable";var g=(0,d.forwardRef)(((e,t)=>(0,m.jsx)(h.ThreadViewportProvider,{children:(0,m.jsx)(f,{...e,ref:t})})));g.displayName="ThreadPrimitive.Viewport"},6586:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{Empty:()=>l.ThreadPrimitiveEmpty,If:()=>d.ThreadPrimitiveIf,Messages:()=>h.ThreadPrimitiveMessages,Root:()=>u.ThreadPrimitiveRoot,ScrollToBottom:()=>m.ThreadPrimitiveScrollToBottom,Suggestion:()=>f.ThreadPrimitiveSuggestion,Viewport:()=>p.ThreadPrimitiveViewport}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(61445),l=r(76373),d=r(47887),p=r(37103),h=r(89341),m=r(28204),f=r(49664)},88313:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{useThreadViewportAutoScroll:()=>b}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(34631),l=r(7509),d=r(64426),p=r(181),h=r(74801),m=r(48714),f=r(31475),g=r(89429),b=({autoScroll:e=!0})=>{const t=(0,l.useRef)(null),r=(0,g.useThreadViewportStore)(),s=(0,l.useRef)(0),o=(0,l.useRef)(!1),n=r=>{const s=t.current;s&&e&&(o.current=!0,s.scrollTo({top:s.scrollHeight,behavior:r}))},a=()=>{const e=t.current;if(!e)return;const n=r.getState().isAtBottom,a=e.scrollHeight-e.scrollTop<=e.clientHeight+1;!a&&s.current<e.scrollTop||(a&&(o.current=!1),a!==n&&(0,f.writableStore)(r).setState({isAtBottom:a})),s.current=e.scrollTop},i=(0,p.useOnResizeContent)((()=>{(o.current||r.getState().isAtBottom)&&n("instant"),a()})),c=(0,m.useManagedRef)((e=>(e.addEventListener("scroll",a),()=>{e.removeEventListener("scroll",a)})));(0,h.useOnScrollToBottom)((()=>{n("auto")}));const b=(0,d.useThreadRuntime)();return(0,l.useEffect)((()=>b.unstable_on("run-start",(()=>n("auto")))),[n,b]),(0,u.useComposedRefs)(i,c,t)}},73511:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{ThreadListPrimitiveItems:()=>m}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(7509),l=r(18491),d=r(76065),p=r(33823),h=(0,u.memo)((({partIndex:e,archived:t,components:r})=>{const s=(0,d.useAssistantRuntime)(),o=(0,u.useMemo)((()=>t?s.threads.getArchivedItemByIndex(e):s.threads.getItemByIndex(e)),[s,e,t]),n=r.ThreadListItem;return(0,p.jsx)(l.ThreadListItemRuntimeProvider,{runtime:o,children:(0,p.jsx)(n,{})})}),((e,t)=>e.partIndex===t.partIndex&&e.archived===t.archived&&e.components.ThreadListItem===t.components.ThreadListItem)),m=({archived:e=!1,components:t})=>{const r=(0,d.useThreadList)((t=>e?t.archivedThreads.length:t.threads.length));return Array.from({length:r},((r,s)=>(0,p.jsx)(h,{partIndex:s,archived:e,components:t},s)))};m.displayName="ThreadListPrimitive.Items"},84834:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{ThreadListPrimitiveNew:()=>m}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(76065),l=r(7509),d=r(37767),p=r(60415),h=r(33823),m=(0,l.forwardRef)((({onClick:e,disabled:t,...r},s)=>{const o=(0,u.useThreadList)((e=>e.newThread===e.mainThreadId)),n=(()=>{const e=(0,u.useAssistantRuntime)();return()=>{e.switchToNewThread()}})();return(0,h.jsx)(d.Primitive.button,{type:"button",...o?{"data-active":"true","aria-current":"true"}:null,...r,ref:s,disabled:t||!n,onClick:(0,p.composeEventHandlers)(e,(()=>{n?.()}))})}));m.displayName="ThreadListPrimitive.New"},68445:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{ThreadListPrimitiveRoot:()=>p}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(37767),l=r(7509),d=r(33823),p=(0,l.forwardRef)(((e,t)=>(0,d.jsx)(u.Primitive.div,{...e,ref:t})));p.displayName="ThreadListPrimitive.Root"},72537:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{Items:()=>l.ThreadListPrimitiveItems,New:()=>u.ThreadListPrimitiveNew,Root:()=>d.ThreadListPrimitiveRoot}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(84834),l=r(73511),d=r(68445)},30902:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{ThreadListItemPrimitiveArchive:()=>p}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(93187),l=r(15571),d=r(7509),p=(0,u.createActionButton)("ThreadListItemPrimitive.Archive",(()=>{const e=(0,l.useThreadListItemRuntime)();return(0,d.useCallback)((()=>{e.archive()}),[e])}))},96241:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{ThreadListItemPrimitiveDelete:()=>d}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(93187),l=r(15571),d=(0,u.createActionButton)("ThreadListItemPrimitive.Delete",(()=>{const e=(0,l.useThreadListItemRuntime)();return()=>{e.delete()}}))},73002:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{ThreadListItemPrimitiveRoot:()=>h}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(37767),l=r(7509),d=r(15571),p=r(33823),h=(0,l.forwardRef)(((e,t)=>{const r=(0,d.useThreadListItem)((e=>e.isMain));return(0,p.jsx)(u.Primitive.div,{...r?{"data-active":"true","aria-current":"true"}:null,...e,ref:t})}));h.displayName="ThreadListItemPrimitive.Root"},45177:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{ThreadListItemPrimitiveTitle:()=>d}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(15571),l=r(33823),d=({fallback:e})=>{const t=(0,u.useThreadListItem)((e=>e.title));return(0,l.jsx)(l.Fragment,{children:t||e})};d.displayName="ThreadListItemPrimitive.Title"},61618:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{ThreadListItemPrimitiveTrigger:()=>d}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(93187),l=r(15571),d=(0,u.createActionButton)("ThreadListItemPrimitive.Trigger",(()=>{const e=(0,l.useThreadListItemRuntime)();return()=>{e.switchTo()}}))},5246:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{ThreadListItemPrimitiveUnarchive:()=>d}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(93187),l=r(15571),d=(0,u.createActionButton)("ThreadListItemPrimitive.Unarchive",(()=>{const e=(0,l.useThreadListItemRuntime)();return()=>{e.unarchive()}}))},20085:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{Archive:()=>l.ThreadListItemPrimitiveArchive,Delete:()=>p.ThreadListItemPrimitiveDelete,Root:()=>u.ThreadListItemPrimitiveRoot,Title:()=>m.ThreadListItemPrimitiveTitle,Trigger:()=>h.ThreadListItemPrimitiveTrigger,Unarchive:()=>d.ThreadListItemPrimitiveUnarchive}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(73002),l=r(30902),d=r(5246),p=r(96241),h=r(61618),m=r(45177)},38952:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{RuntimeAdapterProvider:()=>p,useRuntimeAdapters:()=>h}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(7509),l=r(33823),d=(0,u.createContext)(null),p=({adapters:e,children:t})=>{const r=(0,u.useContext)(d);return(0,l.jsx)(d.Provider,{value:{...r,...e},children:t})},h=()=>(0,u.useContext)(d)},37078:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};function i(e,t){if("*"===t)return!0;const r=t.split(",").map((e=>e.trim().toLowerCase())),s="."+e.name.split(".").pop().toLowerCase(),o=e.type.toLowerCase();for(const e of r){if(e.startsWith(".")&&e===s)return!0;if(e.includes("/")&&e===o)return!0;if(("image/*"===e||"video/*"===e||"audio/*"===e)&&e.endsWith("/*")){const t=e.split("/")[0];if(o.startsWith(t+"/"))return!0}}return!1}((e,t)=>{for(var s in t)r(e,s,{get:t[s],enumerable:!0})})(a,{CompositeAttachmentAdapter:()=>c}),e.exports=(t=a,((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t));var c=class{_adapters;accept;constructor(e){this._adapters=e;const t=e.findIndex((e=>"*"===e.accept));if(-1!==t){if(t!==e.length-1)throw new Error("A wildcard adapter (handling all files) can only be specified as the last adapter.");this.accept="*"}else this.accept=e.map((e=>e.accept)).join(",")}add(e){for(const t of this._adapters)if(i(e.file,t.accept))return t.add(e);throw new Error("No matching adapter found for file")}async send(e){const t=this._adapters.slice();for(const r of t)if(i(e.file,r.accept))return r.send(e);throw new Error("No matching adapter found for attachment")}async remove(e){const t=this._adapters.slice();for(const r of t)if(i({name:e.name,type:e.contentType},r.accept))return r.remove(e);throw new Error("No matching adapter found for attachment")}}},71924:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};((e,t)=>{for(var s in t)r(e,s,{get:t[s],enumerable:!0})})(a,{SimpleImageAttachmentAdapter:()=>i}),e.exports=(t=a,((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t));var i=class{accept="image/*";async add(e){return{id:e.file.name,type:"image",name:e.file.name,contentType:e.file.type,file:e.file,status:{type:"requires-action",reason:"composer-send"}}}async send(e){return{...e,status:{type:"complete"},content:[{type:"image",image:await c(e.file)}]}}async remove(){}},c=e=>new Promise(((t,r)=>{const s=new FileReader;s.onload=()=>t(s.result),s.onerror=e=>r(e),s.readAsDataURL(e)}))},71068:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};((e,t)=>{for(var s in t)r(e,s,{get:t[s],enumerable:!0})})(a,{SimpleTextAttachmentAdapter:()=>i}),e.exports=(t=a,((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t));var i=class{accept="text/plain,text/html,text/markdown,text/csv,text/xml,text/json,text/css";async add(e){return{id:e.file.name,type:"document",name:e.file.name,contentType:e.file.type,file:e.file,status:{type:"requires-action",reason:"composer-send"}}}async send(e){return{...e,status:{type:"complete"},content:[{type:"text",text:`<attachment name=${e.name}>\n${await c(e.file)}\n</attachment>`}]}}async remove(){}},c=e=>new Promise(((t,r)=>{const s=new FileReader;s.onload=()=>t(s.result),s.onerror=e=>r(e),s.readAsText(e)}))},62103:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{CompositeAttachmentAdapter:()=>d.CompositeAttachmentAdapter,SimpleImageAttachmentAdapter:()=>u.SimpleImageAttachmentAdapter,SimpleTextAttachmentAdapter:()=>l.SimpleTextAttachmentAdapter}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(71924),l=r(71068),d=r(37078)},18376:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty;e.exports=(t={},((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t))},87387:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c=(e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let c of a(t))i.call(e,c)||c===r||o(e,c,{get:()=>t[c],enumerable:!(s=n(t,c))||s.enumerable});return e},u=(e,t,r)=>(c(e,t,"default"),r&&c(r,t,"default")),l={};e.exports=(s=l,c(o({},"__esModule",{value:!0}),s)),u(l,r(62103),e.exports),u(l,r(18376),e.exports),u(l,r(42069),e.exports),u(l,r(13415),e.exports)},28317:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};((e,t)=>{for(var s in t)r(e,s,{get:t[s],enumerable:!0})})(a,{WebSpeechSynthesisAdapter:()=>i}),e.exports=(t=a,((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t));var i=class{speak(e){const t=new SpeechSynthesisUtterance(e),r=new Set,s=(e,t)=>{"ended"!==o.status.type&&(o.status={type:"ended",reason:e,error:t},r.forEach((e=>e())))};t.addEventListener("end",(()=>s("finished"))),t.addEventListener("error",(e=>s("error",e.error))),window.speechSynthesis.speak(t);const o={status:{type:"running"},cancel:()=>{window.speechSynthesis.cancel(),s("cancelled")},subscribe:e=>{if("ended"===o.status.type){let t=!1;return queueMicrotask((()=>{t||e()})),()=>{t=!0}}return r.add(e),()=>{r.delete(e)}}};return o}}},42069:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{WebSpeechSynthesisAdapter:()=>u.WebSpeechSynthesisAdapter}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(28317)},13415:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty;e.exports=(t={},((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t))},65645:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{BaseComposerRuntimeCore:()=>l}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(19162),l=class extends u.BaseSubscribable{isEditing=!0;getAttachmentAccept(){return this.getAttachmentAdapter()?.accept??"*"}_attachments=[];get attachments(){return this._attachments}setAttachments(e){this._attachments=e,this._notifySubscribers()}get isEmpty(){return!this.text.trim()&&!this.attachments.length}_text="";get text(){return this._text}_role="user";get role(){return this._role}_runConfig={};get runConfig(){return this._runConfig}setText(e){this._text!==e&&(this._text=e,this._notifySubscribers())}setRole(e){this._role!==e&&(this._role=e,this._notifySubscribers())}setRunConfig(e){this._runConfig!==e&&(this._runConfig=e,this._notifySubscribers())}_emptyTextAndAttachments(){this._attachments=[],this._text="",this._notifySubscribers()}async _onClearAttachments(){const e=this.getAttachmentAdapter();e&&await Promise.all(this._attachments.map((t=>e.remove(t))))}async reset(){if(0===this._attachments.length&&""===this._text&&"user"===this._role&&0===Object.keys(this._runConfig).length)return;this._role="user",this._runConfig={};const e=this._onClearAttachments();this._emptyTextAndAttachments(),await e}async clearAttachments(){const e=this._onClearAttachments();this.setAttachments([]),await e}async send(){const e=this.getAttachmentAdapter(),t=e&&this.attachments.length>0?await Promise.all(this.attachments.map((async t=>(e=>"complete"===e.status.type)(t)?t:await e.send(t)))):[],r={role:this.role,content:this.text?[{type:"text",text:this.text}]:[],attachments:t,runConfig:this.runConfig};this._emptyTextAndAttachments(),this.handleSend(r),this._notifyEventSubscribers("send")}cancel(){this.handleCancel()}async addAttachment(e){const t=this.getAttachmentAdapter();if(!t)throw new Error("Attachments are not supported");const r=e=>{const t=this._attachments.findIndex((t=>t.id===e.id));-1!==t?this._attachments=[...this._attachments.slice(0,t),e,...this._attachments.slice(t+1)]:(this._attachments=[...this._attachments,e],this._notifyEventSubscribers("attachment_add")),this._notifySubscribers()},s=t.add({file:e});if(Symbol.asyncIterator in s)for await(const e of s)r(e);else r(await s);this._notifyEventSubscribers("attachment_add"),this._notifySubscribers()}async removeAttachment(e){const t=this.getAttachmentAdapter();if(!t)throw new Error("Attachments are not supported");const r=this._attachments.findIndex((t=>t.id===e));if(-1===r)throw new Error("Attachment not found");const s=this._attachments[r];await t.remove(s),this._attachments=[...this._attachments.slice(0,r),...this._attachments.slice(r+1)],this._notifySubscribers()}_eventSubscribers=new Map;_notifyEventSubscribers(e){const t=this._eventSubscribers.get(e);if(t)for(const e of t)e()}unstable_on(e,t){const r=this._eventSubscribers.get(e);return r?r.add(t):this._eventSubscribers.set(e,new Set([t])),()=>{const r=this._eventSubscribers.get(e);r&&r.delete(t)}}}},39402:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{DefaultEditComposerRuntimeCore:()=>d}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(87153),l=r(65645),d=class extends l.BaseComposerRuntimeCore{constructor(e,t,{parentId:r,message:s}){super(),this.runtime=e,this.endEditCallback=t,this._parentId=r,this._sourceId=s.id,this._previousText=(0,u.getThreadMessageText)(s),this.setText(this._previousText),this.setRole(s.role),this.setAttachments(s.attachments??[]),this._nonTextParts=s.content.filter((e=>"text"!==e.type)),this.setRunConfig({...e.composer.runConfig})}get canCancel(){return!0}getAttachmentAdapter(){return this.runtime.adapters?.attachments}_nonTextParts;_previousText;_parentId;_sourceId;async handleSend(e){(0,u.getThreadMessageText)(e)!==this._previousText&&this.runtime.append({...e,content:[...e.content,...this._nonTextParts],parentId:this._parentId,sourceId:this._sourceId}),this.handleCancel()}handleCancel(){this.endEditCallback(),this._notifySubscribers()}}},96857:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{DefaultThreadComposerRuntimeCore:()=>l}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(65645),l=class extends u.BaseComposerRuntimeCore{constructor(e){super(),this.runtime=e,this.connect()}_canCancel=!1;get canCancel(){return this._canCancel}get attachments(){return super.attachments}getAttachmentAdapter(){return this.runtime.adapters?.attachments}connect(){return this.runtime.subscribe((()=>{this.canCancel!==this.runtime.capabilities.cancel&&(this._canCancel=this.runtime.capabilities.cancel,this._notifySubscribers())}))}async handleSend(e){this.runtime.append({...e,parentId:this.runtime.messages.at(-1)?.id??null,sourceId:null})}async handleCancel(){this.runtime.cancelRun()}}},32551:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{BaseAssistantRuntimeCore:()=>l}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(76614),l=class{_contextProvider=new u.CompositeContextProvider;registerModelContextProvider(e){return this._contextProvider.registerModelContextProvider(e)}}},84382:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{BaseThreadRuntimeCore:()=>h}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(94533),l=r(96857),d=r(39402),p=r(87153),h=class{constructor(e){this._contextProvider=e}_subscriptions=new Set;_isInitialized=!1;repository=new u.MessageRepository;get messages(){return this.repository.getMessages()}composer=new l.DefaultThreadComposerRuntimeCore(this);getModelContext(){return this._contextProvider.getModelContext()}_editComposers=new Map;getEditComposer(e){return this._editComposers.get(e)}beginEdit(e){if(this._editComposers.has(e))throw new Error("Edit already in progress");this._editComposers.set(e,new d.DefaultEditComposerRuntimeCore(this,(()=>this._editComposers.delete(e)),this.repository.getMessage(e))),this._notifySubscribers()}getMessageById(e){return this.repository.getMessage(e)}getBranches(e){return this.repository.getBranches(e)}switchToBranch(e){this.repository.switchToBranch(e),this._notifySubscribers()}_notifySubscribers(){for(const e of this._subscriptions)e()}_notifyEventSubscribers(e){const t=this._eventSubscribers.get(e);if(t)for(const e of t)e()}subscribe(e){return this._subscriptions.add(e),()=>this._subscriptions.delete(e)}_submittedFeedback={};getSubmittedFeedback(e){return this._submittedFeedback[e]}submitFeedback({messageId:e,type:t}){const r=this.adapters?.feedback;if(!r)throw new Error("Feedback adapter not configured");const{message:s}=this.repository.getMessage(e);r.submit({message:s,type:t}),this._submittedFeedback[e]={type:t},this._notifySubscribers()}_stopSpeaking;speech;speak(e){const t=this.adapters?.speech;if(!t)throw new Error("Speech adapter not configured");const{message:r}=this.repository.getMessage(e);this._stopSpeaking?.();const s=t.speak((0,p.getThreadMessageText)(r)),o=s.subscribe((()=>{"ended"===s.status.type?(this._stopSpeaking=void 0,this.speech=void 0):this.speech={messageId:e,status:s.status},this._notifySubscribers()}));this.speech={messageId:e,status:s.status},this._notifySubscribers(),this._stopSpeaking=()=>{s.cancel(),o(),this.speech=void 0,this._stopSpeaking=void 0}}stopSpeaking(){if(!this._stopSpeaking)throw new Error("No message is being spoken");this._stopSpeaking(),this._notifySubscribers()}ensureInitialized(){this._isInitialized||(this._isInitialized=!0,this._notifyEventSubscribers("initialize"))}export(){return this.repository.export()}import(e){this.ensureInitialized(),this.repository.clear(),this.repository.import(e),this._notifySubscribers()}_eventSubscribers=new Map;unstable_on(e,t){if("model-context-update"===e)return this._contextProvider.subscribe?.(t)??(()=>{});const r=this._eventSubscribers.get(e);return r?r.add(t):this._eventSubscribers.set(e,new Set([t])),()=>{this._eventSubscribers.get(e).delete(t)}}}},83969:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty;e.exports=(t={},((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t))},24291:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{DangerousInBrowserAdapter:()=>f}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(88333),l=r(38420),d=r(27301),p=r(17802),h=r(64614),m=r(29158),f=class{constructor(e){this.options=e}async*run({messages:e,abortSignal:t,context:r}){const s=(await(0,h.getEdgeRuntimeStream)({options:this.options,abortSignal:t,requestData:{system:r.system,messages:(0,u.toCoreMessages)(e),tools:r.tools?(0,l.toLanguageModelTools)(r.tools):[],...r.callSettings,...r.config}})).pipeThrough((0,d.toolResultStream)(r.tools,t)).pipeThrough(new m.AssistantMessageAccumulator);for await(const e of(0,p.asAsyncIterable)(s))yield e}}},5663:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{useDangerousInBrowserRuntime:()=>u.useDangerousInBrowserRuntime}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(47755)},47755:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{useDangerousInBrowserRuntime:()=>h}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(39033),l=r(7509),d=r(24291),p=r(99628),h=e=>{const{localRuntimeOptions:t,otherOptions:r}=(0,p.splitLocalRuntimeOptions)(e),[s]=(0,l.useState)((()=>new d.DangerousInBrowserAdapter(r)));return(0,u.useLocalRuntime)(s,t)}},17802:(e,t,r)=>{var s,o=Object.create,n=Object.defineProperty,a=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,c=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty,l=(e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let o of i(t))u.call(e,o)||o===r||n(e,o,{get:()=>t[o],enumerable:!(s=a(t,o))||s.enumerable});return e},d={};((e,t)=>{for(var r in t)n(e,r,{get:t[r],enumerable:!0})})(d,{EdgeModelAdapter:()=>w,asAsyncIterable:()=>O}),e.exports=(s=d,l(n({},"__esModule",{value:!0}),s));var p=r(88333),h=r(38420),m=r(27301),f=r(58732),g=r(23194),b=((e,t,r)=>(r=null!=e?o(c(e)):{},l(e&&e.__esModule?r:n(r,"default",{value:e,enumerable:!0}),e)))(r(17609)),y=r(29158);function O(e){return{[Symbol.asyncIterator]:()=>{const t=e.getReader();return{async next(){const{done:e,value:r}=await t.read();return e?{done:!0,value:void 0}:{done:!1,value:r}}}}}}var w=class{constructor(e){this.options=e}async*run({messages:e,runConfig:t,abortSignal:r,context:s,unstable_assistantMessageId:o,unstable_getMessage:n}){const a="function"==typeof this.options.headers?await this.options.headers():this.options.headers,i=new Headers(a);i.set("Content-Type","application/json");const c=await fetch(this.options.api,{method:"POST",headers:i,credentials:this.options.credentials??"same-origin",body:JSON.stringify({system:s.system,messages:this.options.unstable_AISDKInterop?(0,f.toLanguageModelMessages)(e,{unstable_includeId:this.options.unstable_sendMessageIds||this.options.sendExtraMessageFields}):(0,p.toCoreMessages)(e,{unstable_includeId:this.options.unstable_sendMessageIds||this.options.sendExtraMessageFields}),tools:s.tools?"v2"===this.options.unstable_AISDKInterop?(u=s.tools,Object.fromEntries(Object.entries(u).map((([e,t])=>[e,{...t.description?{description:t.description}:void 0,parameters:t.parameters instanceof g.z.ZodType?(0,b.default)(t.parameters):t.parameters}])))):(0,h.toLanguageModelTools)(s.tools):[],unstable_assistantMessageId:o,runConfig:t,...s.callSettings,...s.config,...this.options.body}),signal:r});var u;await(this.options.onResponse?.(c));try{if(!c.ok)throw new Error(`Status ${c.status}: ${await c.text()}`);if(!c.body)throw new Error("Response body is null");const e=c.body.pipeThrough(new y.DataStreamDecoder).pipeThrough((0,m.toolResultStream)(s.tools,r)).pipeThrough(new y.AssistantMessageAccumulator);for await(const t of O(e))yield t;this.options.onFinish?.(n())}catch(e){throw this.options.onError?.(e),e}}}},58153:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{EdgeRuntimeRequestOptionsSchema:()=>v}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(40387),l=r(23194),d=l.z.object({type:l.z.literal("function"),name:l.z.string(),description:l.z.string().optional(),parameters:l.z.custom((e=>"object"==typeof e&&null!==e))}),p=l.z.object({type:l.z.literal("text"),text:l.z.string()}),h=l.z.object({type:l.z.literal("image"),image:l.z.string()}),m=l.z.object({type:l.z.literal("file"),data:l.z.string(),mimeType:l.z.string()}),f=l.z.object({type:l.z.literal("audio"),audio:l.z.object({data:l.z.string(),format:l.z.union([l.z.literal("mp3"),l.z.literal("wav")])})}),g=l.z.object({type:l.z.literal("tool-call"),toolCallId:l.z.string(),toolName:l.z.string(),args:l.z.record(l.z.unknown()).refine((e=>void 0!==e)),result:l.z.unknown().optional(),isError:l.z.boolean().optional()}),b=l.z.object({role:l.z.literal("user"),content:l.z.array(l.z.discriminatedUnion("type",[p,h,m,f])).min(1).readonly()}),y=l.z.object({role:l.z.literal("assistant"),content:l.z.array(l.z.discriminatedUnion("type",[p,g])).min(1).readonly()}),O=l.z.object({role:l.z.literal("system"),content:l.z.tuple([p]).readonly()}),w=l.z.discriminatedUnion("role",[O,b,y]),v=l.z.object({system:l.z.string().optional(),messages:l.z.array(w).min(1).readonly(),runConfig:l.z.object({custom:l.z.record(l.z.unknown()).optional()}).optional(),tools:l.z.array(d).readonly().optional(),unstable_assistantMessageId:l.z.string().optional()}).merge(u.LanguageModelV1CallSettingsSchema).merge(u.LanguageModelConfigSchema)},99981:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{fromCoreMessage:()=>d,fromCoreMessages:()=>l}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(51764),l=e=>e.map((e=>d(e))),d=(e,{id:t=(0,u.generateId)(),status:r={type:"complete",reason:"unknown"},attachments:s=[]}={})=>{const o={id:t,createdAt:new Date},n=e.role;switch(n){case"assistant":return{...o,role:n,content:e.content.map((e=>"tool-call"===e.type?{...e,argsText:JSON.stringify(e.args)}:e)),status:r,metadata:{unstable_annotations:[],unstable_data:[],steps:[],custom:{}}};case"user":return{...o,role:n,content:e.content,attachments:s,metadata:{custom:{}}};case"system":return{...o,role:n,content:e.content,metadata:{custom:{}}};default:throw new Error(`Unknown message role: ${n}`)}}},71469:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};((e,t)=>{for(var s in t)r(e,s,{get:t[s],enumerable:!0})})(a,{fromLanguageModelMessages:()=>i}),e.exports=(t=a,((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t));var i=(e,{mergeSteps:t}={})=>{const r=[];for(const s of e){const e=s.role;switch(e){case"system":r.push({role:"system",content:[{type:"text",text:s.content}]});break;case"user":r.push({role:"user",content:s.content.map((e=>{const t=e.type;switch(t){case"text":return{type:"text",text:e.text};case"image":if(e.image instanceof URL)return{type:"image",image:e.image.href};throw new Error("Only images with URL data are supported");case"file":if(e.data instanceof URL)return{type:"file",data:e.data.href,mimeType:e.mimeType};throw new Error("Only files with URL data are supported");default:throw new Error(`Unknown content part type: ${t}`)}}))});break;case"assistant":{const e=s.content.map((e=>"tool-call"===e.type?{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,argsText:JSON.stringify(e.args),args:e.args}:"redacted-reasoning"===e.type||"file"===e.type||"reasoning"===e.type?null:e)).filter((e=>!!e));if(t){const t=r[r.length-1];if("assistant"===t?.role){t.content=[...t.content,...e];break}}r.push({role:"assistant",content:e});break}case"tool":{const e=r[r.length-1];if("assistant"!==e?.role)throw new Error("A tool message must be preceded by an assistant message.");for(const t of s.content){const r=e.content.find((e=>"tool-call"===e.type&&e.toolCallId===t.toolCallId));if(!r)throw new Error("Received tool result for an unknown tool call.");if(r.toolName!==t.toolName)throw new Error("Tool call name mismatch.");const s=r;s.result=t.result,t.isError&&(s.isError=!0)}break}default:throw new Error(`Unknown message role: ${e}`)}}return r}},70275:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};((e,t)=>{for(var s in t)r(e,s,{get:t[s],enumerable:!0})})(a,{fromLanguageModelTools:()=>i}),e.exports=(t=a,((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t));var i=e=>Object.fromEntries(e.map((e=>[e.name,{description:e.description,parameters:e.parameters}])))},58732:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{fromCoreMessage:()=>d.fromCoreMessage,fromCoreMessages:()=>d.fromCoreMessages,fromLanguageModelMessages:()=>l.fromLanguageModelMessages,fromLanguageModelTools:()=>h.fromLanguageModelTools,toCoreMessage:()=>p.toCoreMessage,toCoreMessages:()=>p.toCoreMessages,toLanguageModelMessages:()=>u.toLanguageModelMessages,toLanguageModelTools:()=>m.toLanguageModelTools}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(51633),l=r(71469),d=r(99981),p=r(88333),h=r(70275),m=r(38420)},88333:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};((e,t)=>{for(var s in t)r(e,s,{get:t[s],enumerable:!0})})(a,{toCoreMessage:()=>c,toCoreMessages:()=>i}),e.exports=(t=a,((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t));var i=(e,t={})=>e.map((e=>c(e,t))),c=(e,t={})=>{const r=t.unstable_includeId??!1,s=e.role;switch(s){case"assistant":return{role:s,content:e.content.map((e=>{if("reasoning"===e.type||"source"===e.type||"file"===e.type)return null;if("tool-call"===e.type){const{argsText:t,...r}=e;return r}return e})).filter((e=>!!e)),...r?{unstable_id:e.id}:{}};case"user":return{role:s,content:[...e.content,...e.attachments.map((e=>e.content)).flat()],...r?{unstable_id:e.id}:{}};case"system":return{role:s,content:e.content,...r?{unstable_id:e.id}:{}};default:throw new Error(`Unknown message role: ${s}`)}}},51633:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};((e,t)=>{for(var s in t)r(e,s,{get:t[s],enumerable:!0})})(a,{toLanguageModelMessages:()=>c}),e.exports=(t=a,((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t));var i=()=>{const e=[];let t={role:"assistant",content:[]},r={role:"tool",content:[]};return{addTextContentPart:s=>{r.content.length>0&&(e.push(t),e.push(r),t={role:"assistant",content:[]},r={role:"tool",content:[]}),t.content.push(s)},addToolCallPart:e=>{t.content.push({type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,args:e.args}),r.content.push({type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,..."artifact"in e?{artifact:e.artifact}:{},result:void 0===e.result?"Error: tool is has no configured code to run":e.result,isError:e.isError??void 0===e.result})},getMessages:()=>r.content.length>0?[...e,t,r]:[...e,t]}};function c(e,t={}){const r=t.unstable_includeId??!1;return e.flatMap((e=>{const t=e.role;switch(t){case"system":return[{...r?{unstable_id:e.id}:{},role:"system",content:e.content[0].text}];case"user":{const t="attachments"in e?e.attachments:[],s=[...e.content,...t.map((e=>e.content)).flat()];return[{...r?{unstable_id:e.id}:{},role:"user",content:s.map((e=>{const t=e.type;switch(t){case"text":return e;case"image":return{type:"image",image:new URL(e.image)};case"file":return{type:"file",data:new URL(e.data),mimeType:e.mimeType};default:throw new Error(`Unspported content part type: ${t}`)}}))}]}case"assistant":{const t=i();for(const r of e.content){const e=r.type;switch(e){case"reasoning":case"source":case"file":break;case"text":t.addTextContentPart(r);break;case"tool-call":t.addToolCallPart(r);break;default:throw new Error(`Unhandled content part type: ${e}`)}}return t.getMessages()}default:throw new Error(`Unknown message role: ${t}`)}}))}},38420:(e,t,r)=>{var s,o=Object.create,n=Object.defineProperty,a=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,c=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty,l=(e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let o of i(t))u.call(e,o)||o===r||n(e,o,{get:()=>t[o],enumerable:!(s=a(t,o))||s.enumerable});return e},d={};((e,t)=>{for(var r in t)n(e,r,{get:t[r],enumerable:!0})})(d,{toLanguageModelTools:()=>m}),e.exports=(s=d,l(n({},"__esModule",{value:!0}),s));var p=r(23194),h=((e,t,r)=>(r=null!=e?o(c(e)):{},l(e&&e.__esModule?r:n(r,"default",{value:e,enumerable:!0}),e)))(r(17609)),m=e=>Object.entries(e).map((([e,t])=>({type:"function",name:e,...t.description?{description:t.description}:void 0,parameters:t.parameters instanceof p.z.ZodType?(0,h.default)(t.parameters):t.parameters})))},64614:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{convertToLanguageModelPrompt:()=>O,createEdgeRuntimeAPI:()=>y,getEdgeRuntimeResponse:()=>b,getEdgeRuntimeStream:()=>g}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(58153),l=r(51633),d=r(38420),p=r(27301),h=r(40387),m=r(29158),f=r(35270),g=async({abortSignal:e,requestData:t,options:{model:r,system:s,tools:o={},toolChoice:n,onFinish:a,...i}})=>{const c=h.LanguageModelV1CallSettingsSchema.parse(i),l=(0,d.toLanguageModelTools)(o),g=Object.values(o).some((e=>!!e.execute)),{system:b,tools:y=[],messages:w,apiKey:v,baseUrl:_,modelName:j,...P}=u.EdgeRuntimeRequestOptionsSchema.parse(t),T=[];s&&T.push(s),b&&T.push(b);const I=T.join("\n\n");for(const e of y)if(o?.[e.name])throw new Error(`Tool ${e.name} was defined in both the client and server tools. This is not allowed.`);const x="function"==typeof r?await r({apiKey:v,baseUrl:_,modelName:j}):r;let M;const E=await async function({model:e,system:t,messages:r,tools:s,toolChoice:o,...n}){return e.doStream({inputFormat:"messages",mode:{type:"regular",...s?{tools:s}:void 0,...o?{toolChoice:o}:void 0},prompt:O(t,r),...n})}({...c,...P,model:x,abortSignal:e,...I?{system:I}:void 0,messages:w,tools:l.concat(y),...n?{toolChoice:n}:void 0});M=E.stream.pipeThrough(new f.LanguageModelV1StreamDecoder);const S=g&&"none"!==n?.type;if(S&&(M=M.pipeThrough((0,p.toolResultStream)(o,e))),S||a){const e=M.tee();M=e[0];let t=e[1];if(a){let e;t.pipeThrough(new m.AssistantMessageAccumulator).pipeTo(new WritableStream({write(t){e=t},close(){if(!e?.status||"running"===e.status.type)return;const t=[...w,{id:"DEFAULT",createdAt:new Date,role:"assistant",content:e.content,status:e.status,metadata:e.metadata}];a({messages:t,metadata:{steps:e.metadata.steps}})},abort(e){console.error("Server stream processing error:",e)}}))}}return M},b=async e=>{const t=await g(e);return new Response(t.pipeThrough(new m.DataStreamEncoder),{headers:{"Content-Type":"text/plain; charset=utf-8","x-vercel-ai-data-stream":"v1"}})},y=e=>({POST:async t=>b({abortSignal:t.signal,requestData:await t.json(),options:e})});function O(e,t){const r=[];return null!=e&&r.push({role:"system",content:e}),r.push(...(0,l.toLanguageModelMessages)(t)),r}},21306:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c=(e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let c of a(t))i.call(e,c)||c===r||o(e,c,{get:()=>t[c],enumerable:!(s=n(t,c))||s.enumerable});return e},u={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(u,{EdgeChatAdapter:()=>d.EdgeModelAdapter,unstable_runPendingTools:()=>p.unstable_runPendingTools,useEdgeRuntime:()=>l.useEdgeRuntime}),e.exports=(s=u,c(o({},"__esModule",{value:!0}),s)),((e,t,r)=>{c(e,t,"default"),r&&c(r,t,"default")})(u,r(58732),e.exports);var l=r(78493),d=r(17802),p=r(27301)},27301:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{toolResultStream:()=>m,unstable_runPendingTools:()=>h}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(23194),l=r(29158),d=r(29158);function p(e,t,r){const s=e?.[r.toolName];if(!s||!s.execute)return;let o=s.execute;if(s.parameters instanceof u.z.ZodType){const e=s.parameters.safeParse(r.args);e.success||(o=s.experimental_onSchemaValidationError??(()=>{throw new Error(`Function parameter validation failed. ${JSON.stringify(e.error.issues)}`)}))}return(async()=>{const e=await o(r.args,{toolCallId:r.toolCallId,abortSignal:t});return e instanceof d.ToolResponse?e:new d.ToolResponse({result:void 0===e?"<no result>":e})})()}async function h(e,t,r){for(const s of e.parts)if("tool-call"===s.type){const o=p(t,r,s);if(o){const t=await o,r=e.parts.map((e=>"tool-call"===e.type&&e.toolCallId===s.toolCallId?{...e,state:"result",artifact:t.artifact,result:t.result,isError:t.isError}:e));e={...e,parts:r,content:r}}}return e}function m(e,t){return new l.ToolExecutionStream((r=>p(e,t,r)))}},78493:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{useEdgeRuntime:()=>p}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(39033),l=r(17802),d=r(99628),p=e=>{const{localRuntimeOptions:t,otherOptions:r}=(0,d.splitLocalRuntimeOptions)(e);return(0,u.useLocalRuntime)(new l.EdgeModelAdapter(r),t)}},2086:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{ExternalStoreRuntimeCore:()=>h}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(51764),l=r(58002),d=r(59659),p=e=>e.adapters?.threadList??{},h=class extends u.BaseAssistantRuntimeCore{threads;constructor(e){super(),this.threads=new l.ExternalStoreThreadListRuntimeCore(p(e),(()=>new d.ExternalStoreThreadRuntimeCore(this._contextProvider,e)))}setAdapter(e){this.threads.__internal_setAdapter(p(e)),this.threads.getMainThreadRuntimeCore().__internal_setAdapter(e)}}},58002:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};((e,t)=>{for(var s in t)r(e,s,{get:t[s],enumerable:!0})})(a,{ExternalStoreThreadListRuntimeCore:()=>p}),e.exports=(t=a,((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t));var i=Object.freeze([]),c="DEFAULT_THREAD_ID",u=Object.freeze([c]),l=Object.freeze({threadId:c,status:"regular"}),d=Promise.resolve(),p=class{constructor(e={},t){this.adapter=e,this.threadFactory=t,this._mainThread=this.threadFactory()}_mainThreadId=c;_threads=u;_archivedThreads=i;get newThreadId(){}get threadIds(){return this._threads}get archivedThreadIds(){return this._archivedThreads}getLoadThreadsPromise(){return d}_mainThread;get mainThreadId(){return this._mainThreadId}getMainThreadRuntimeCore(){return this._mainThread}getThreadRuntimeCore(){throw new Error("Method not implemented.")}getItemById(e){for(const t of this.adapter.threads??[])if(t.threadId===e)return t;for(const t of this.adapter.archivedThreads??[])if(t.threadId===e)return t;if(e===c)return l}__internal_setAdapter(e){const t=this.adapter;this.adapter=e;const r=e.threadId??c,s=e.threads??i,o=e.archivedThreads??i,n=t.threadId??c,a=t.threads??i,u=t.archivedThreads??i;n===r&&a===s&&u===o||(a!==s&&(this._threads=this.adapter.threads?.map((e=>e.threadId))??i),u!==o&&(this._archivedThreads=this.adapter.archivedThreads?.map((e=>e.threadId))??i),n!==r&&(this._mainThreadId=r,this._mainThread=this.threadFactory()),this._notifySubscribers())}async switchToThread(e){if(this._mainThreadId===e)return;const t=this.adapter.onSwitchToThread;if(!t)throw new Error("External store adapter does not support switching to thread");t(e)}async switchToNewThread(){const e=this.adapter.onSwitchToNewThread;if(!e)throw new Error("External store adapter does not support switching to new thread");e()}async rename(e,t){const r=this.adapter.onRename;if(!r)throw new Error("External store adapter does not support renaming");r(e,t)}async archive(e){const t=this.adapter.onArchive;if(!t)throw new Error("External store adapter does not support archiving");t(e)}async unarchive(e){const t=this.adapter.onUnarchive;if(!t)throw new Error("External store adapter does not support unarchiving");t(e)}async delete(e){const t=this.adapter.onDelete;if(!t)throw new Error("External store adapter does not support deleting");t(e)}initialize(){throw new Error("Method not implemented.")}generateTitle(){throw new Error("Method not implemented.")}_subscriptions=new Set;subscribe(e){return this._subscriptions.add(e),()=>this._subscriptions.delete(e)}_notifySubscribers(){for(const e of this._subscriptions)e()}}},59659:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{ExternalStoreThreadRuntimeCore:()=>b,hasUpcomingMessage:()=>g}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(43216),l=r(53035),d=r(89549),p=r(89129),h=r(87153),m=r(84382),f=Object.freeze([]),g=(e,t)=>e&&"assistant"!==t[t.length-1]?.role,b=class extends m.BaseThreadRuntimeCore{assistantOptimisticId=null;_capabilities={switchToBranch:!1,edit:!1,reload:!1,cancel:!1,unstable_copy:!1,speech:!1,attachments:!1,feedback:!1};get capabilities(){return this._capabilities}_messages;isDisabled;get messages(){return this._messages}get adapters(){return this._store.adapters}suggestions=[];extras=void 0;_converter=new l.ThreadMessageConverter;_store;beginEdit(e){if(!this._store.onEdit)throw new Error("Runtime does not support editing.");super.beginEdit(e)}constructor(e,t){super(e),this.__internal_setAdapter(t)}__internal_setAdapter(e){if(this._store===e)return;const t=e.isRunning??!1;this.isDisabled=e.isDisabled??!1;const r=this._store;if(this._store=e,this.extras=e.extras,this.suggestions=e.suggestions??f,this._capabilities={switchToBranch:void 0!==this._store.setMessages,edit:void 0!==this._store.onEdit,reload:void 0!==this._store.onReload,cancel:void 0!==this._store.onCancel,speech:void 0!==this._store.adapters?.speech,unstable_copy:!1!==this._store.unstable_capabilities?.copy,attachments:!!this._store.adapters?.attachments,feedback:!!this._store.adapters?.feedback},r)if(r.convertMessage!==e.convertMessage)this._converter=new l.ThreadMessageConverter;else if(r.isRunning===e.isRunning&&r.messages===e.messages)return void this._notifySubscribers();const s=e.convertMessage?this._converter.convertMessages(e.messages,((r,s,o)=>{if(!e.convertMessage)return s;const n=o===e.messages.length-1,a=(0,d.getAutoStatus)(n,t);if(r&&("assistant"!==r.role||!(0,d.isAutoStatus)(r.status)||r.status===a))return r;const i=e.convertMessage(s,o),c=(0,p.fromThreadMessageLike)(i,o.toString(),a);return c[u.symbolInnerMessage]=s,c})):e.messages;s.length>0&&this.ensureInitialized(),(r?.isRunning??!1!==e.isRunning)&&(e.isRunning?this._notifyEventSubscribers("run-start"):this._notifyEventSubscribers("run-end"));for(let e=0;e<s.length;e++){const t=s[e],r=s[e-1];this.repository.addOrUpdateMessage(r?.id??null,t)}this.assistantOptimisticId&&(this.repository.deleteMessage(this.assistantOptimisticId),this.assistantOptimisticId=null),g(t,s)&&(this.assistantOptimisticId=this.repository.appendOptimisticMessage(s.at(-1)?.id??null,{role:"assistant",content:[]})),this.repository.resetHead(this.assistantOptimisticId??s.at(-1)?.id??null),this._messages=this.repository.getMessages(),this._notifySubscribers()}switchToBranch(e){if(!this._store.setMessages)throw new Error("Runtime does not support switching branches.");this.repository.switchToBranch(e),this.updateMessages(this.repository.getMessages())}async append(e){if(e.parentId!==(this.messages.at(-1)?.id??null)){if(!this._store.onEdit)throw new Error("Runtime does not support editing messages.");await this._store.onEdit(e)}else await this._store.onNew(e)}async startRun(e){if(!this._store.onReload)throw new Error("Runtime does not support reloading messages.");await this._store.onReload(e.parentId,e)}async resumeRun(){throw new Error("Runtime does not support resuming runs.")}cancelRun(){if(!this._store.onCancel)throw new Error("Runtime does not support cancelling runs.");this._store.onCancel(),this.assistantOptimisticId&&(this.repository.deleteMessage(this.assistantOptimisticId),this.assistantOptimisticId=null);let e=this.repository.getMessages();const t=e[e.length-1];"user"===t?.role&&t.id===e.at(-1)?.id?(this.repository.deleteMessage(t.id),this.composer.text.trim()||this.composer.setText((0,h.getThreadMessageText)(t)),e=this.repository.getMessages()):this._notifySubscribers(),setTimeout((()=>{this.updateMessages(e)}),0)}addToolResult(e){if(!this._store.onAddToolResult)throw new Error("Runtime does not support tool results.");this._store.onAddToolResult(e)}updateMessages=e=>{void 0!==this._store.convertMessage?this._store.setMessages?.(e.flatMap(u.getExternalStoreMessage).filter((e=>null!=e))):this._store.setMessages?.(e)}}},53035:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};((e,t)=>{for(var s in t)r(e,s,{get:t[s],enumerable:!0})})(a,{ThreadMessageConverter:()=>i}),e.exports=(t=a,((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t));var i=class{cache=new WeakMap;convertMessages(e,t){return e.map(((e,r)=>{const s=this.cache.get(e),o=t(s,e,r);return this.cache.set(e,o),o}))}}},89129:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{fromThreadMessageLike:()=>d}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(51764),l=r(62437),d=(e,t,r)=>{const{role:s,id:o,createdAt:n,attachments:a,status:i,metadata:c}=e,d={id:o??t,createdAt:n??new Date},p="string"==typeof e.content?[{type:"text",text:e.content}]:e.content;if("user"!==s&&a)throw new Error("attachments are only supported for user messages");if("assistant"!==s&&i)throw new Error("status is only supported for assistant messages");if("assistant"!==s&&c?.steps)throw new Error("metadata.steps is only supported for assistant messages");switch(s){case"assistant":return{...d,role:s,content:p.map((e=>{const t=e.type;switch(t){case"text":case"reasoning":return 0===e.text.trim().length?null:e;case"file":case"source":return e;case"tool-call":return e.args?{...e,toolCallId:e.toolCallId??"tool-"+(0,u.generateId)(),args:e.args,argsText:JSON.stringify(e.args)}:{...e,toolCallId:e.toolCallId??"tool-"+(0,u.generateId)(),args:e.args??(0,l.parsePartialJson)(e.argsText??"{}"),argsText:e.argsText??""};default:throw new Error(`Unsupported assistant content part type: ${t}`)}})).filter((e=>!!e)),status:i??r,metadata:{unstable_annotations:c?.unstable_annotations??[],unstable_data:c?.unstable_data??[],custom:c?.custom??{},steps:c?.steps??[]}};case"user":return{...d,role:s,content:p.map((e=>{const t=e.type;switch(t){case"text":case"image":case"audio":case"file":return e;default:throw new Error(`Unsupported user content part type: ${t}`)}})),attachments:a??[],metadata:{custom:c?.custom??{}}};case"system":if(1!==p.length||"text"!==p[0].type)throw new Error("System messages must have exactly one text content part.");return{...d,role:s,content:p,metadata:{custom:c?.custom??{}}};default:throw new Error(`Unknown message role: ${s}`)}}},89549:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};((e,t)=>{for(var s in t)r(e,s,{get:t[s],enumerable:!0})})(a,{getAutoStatus:()=>l,isAutoStatus:()=>u}),e.exports=(t=a,((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t));var i=Object.freeze({type:"running"}),c=Object.freeze({type:"complete",reason:"unknown"}),u=e=>e===i||e===c,l=(e,t)=>e&&t?i:c},31917:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{createMessageConverter:()=>p}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(76065),l=r(76764),d=r(43216),p=e=>{const t={useThreadMessages:(t,r)=>(0,l.useExternalMessageConverter)({callback:e,messages:t,isRunning:r}),toThreadMessages:t=>(0,l.convertExternalMessages)(t,e,!1),toOriginalMessages:e=>{const t=(0,d.getExternalStoreMessages)(e);if(0===t.length)throw new Error("No original messages found");return t},toOriginalMessage:e=>t.toOriginalMessages(e)[0],useOriginalMessage:()=>t.useOriginalMessages()[0],useOriginalMessages:()=>{const e=(0,u.useContentPart)({optional:!0,selector:d.getExternalStoreMessages}),t=(0,u.useMessage)(d.getExternalStoreMessages),r=e??t;if(0===r.length)throw new Error("No original messages found");return r}};return t}},76764:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{convertExternalMessages:()=>g,useExternalMessageConverter:()=>b}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(7509),l=r(53035),d=r(43216),p=r(89129),h=r(89549),m=e=>{const t={role:"assistant",content:[]};for(const r of e)if("tool"===r.role){const e=t.content.findIndex((e=>"tool-call"===e.type&&e.toolCallId===r.toolCallId));if(-1===e)throw new Error(`Tool call ${r.toolCallId} ${r.toolName} not found in assistant message`);{const s=t.content[e];if(r.toolName&&s.toolName!==r.toolName)throw new Error(`Tool call name ${r.toolCallId} ${r.toolName} does not match existing tool call ${s.toolName}`);t.content[e]={...s,[d.symbolInnerMessage]:[...s[d.symbolInnerMessage]??[],r],result:r.result}}}else{const e=r.role,s=("string"==typeof r.content?[{type:"text",text:r.content}]:r.content).map((e=>({...e,[d.symbolInnerMessage]:[r]})));switch(e){case"system":case"user":return{...r,content:s};case"assistant":0===t.content.length&&(t.id=r.id,t.createdAt??=r.createdAt,t.status??=r.status,r.attachments&&(t.attachments=[...t.attachments??[],...r.attachments]),r.metadata&&(t.metadata??={},r.metadata.unstable_annotations&&(t.metadata.unstable_annotations=[...t.metadata.unstable_annotations??[],...r.metadata.unstable_annotations]),r.metadata.unstable_data&&(t.metadata.unstable_data=[...t.metadata.unstable_data??[],...r.metadata.unstable_data]),r.metadata.steps&&(t.metadata.steps=[...t.metadata.steps??[],...r.metadata.steps]),r.metadata.custom&&(t.metadata.custom={...t.metadata.custom??{},...r.metadata.custom}))),t.content.push(...s);break;default:throw new Error(`Unknown message role: ${e}`)}}return t},f=(e,t)=>{const r=[];let s=!1,o=!1,n=[],a=[];const i=()=>{a.length&&r.push({inputs:n,outputs:a}),n=[],a=[],s=!1,o=!1};for(const r of e)for(const e of r.outputs)(o&&"tool"!==e.role||!s||"user"===e.role||"system"===e.role)&&i(),s="assistant"===e.role||"tool"===e.role,n.at(-1)!==r.input&&n.push(r.input),a.push(e),"assistant"!==e.role||"none"!==e.convertConfig?.joinStrategy&&"none"!==t||(o=!0);return i(),r},g=(e,t,r)=>{const s=[];for(const r of e){const e=t(r),o={input:r,outputs:Array.isArray(e)?e:[e]};s.push(o)}const o=f(s);return o.map(((e,t)=>{const s=t===o.length-1,n=(0,h.getAutoStatus)(s,r),a=(0,p.fromThreadMessageLike)(m(e.outputs),t.toString(),n);return a[d.symbolInnerMessage]=e.inputs,a}))},b=({callback:e,messages:t,isRunning:r,joinStrategy:s})=>{const o=(0,u.useMemo)((()=>({callback:e,callbackCache:new WeakMap,chunkCache:new WeakMap,converterCache:new l.ThreadMessageConverter})),[e]);return(0,u.useMemo)((()=>{const e=[];for(const r of t){let t=o.callbackCache.get(r);if(!t){const e=o.callback(r);t={input:r,outputs:Array.isArray(e)?e:[e]},o.callbackCache.set(r,t)}e.push(t)}const n=f(e,s).map((e=>{const t=e.outputs[0];if(!t)return e;const r=o.chunkCache.get(t);return r&&y(r.outputs,e.outputs)?r:(o.chunkCache.set(t,e),e)})),a=o.converterCache.convertMessages(n,((e,t,s)=>{const o=s===n.length-1,a=(0,h.getAutoStatus)(o,r);if(e&&("assistant"!==e.role||!(0,h.isAutoStatus)(e.status)||e.status===a)){const r=(0,d.getExternalStoreMessages)(e);if(y(r,t.inputs))return e}const i=(0,p.fromThreadMessageLike)(m(t.outputs),s.toString(),a);return i[d.symbolInnerMessage]=t.inputs,i}));return a[d.symbolInnerMessage]=t,a}),[o,t,r,s])},y=(e,t)=>{if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}},43216:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};((e,t)=>{for(var s in t)r(e,s,{get:t[s],enumerable:!0})})(a,{getExternalStoreMessage:()=>u,getExternalStoreMessages:()=>d,symbolInnerMessage:()=>i}),e.exports=(t=a,((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t));var i=Symbol("innerMessage"),c=Symbol("innerMessages"),u=e=>e[i],l=[],d=e=>{const t="messages"in e?e.messages:e,r=t[c]||t[i];return r?Array.isArray(r)?r:(t[c]=[r],t[c]):l}},9717:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{getExternalStoreMessage:()=>l.getExternalStoreMessage,getExternalStoreMessages:()=>l.getExternalStoreMessages,unstable_convertExternalMessages:()=>d.convertExternalMessages,unstable_createMessageConverter:()=>p.createMessageConverter,useExternalMessageConverter:()=>d.useExternalMessageConverter,useExternalStoreRuntime:()=>u.useExternalStoreRuntime}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(22506),l=r(43216),d=r(76764),p=r(31917)},22506:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{useExternalStoreRuntime:()=>h}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(7509),l=r(2086),d=r(35297),p=r(38952),h=e=>{const[t]=(0,u.useState)((()=>new l.ExternalStoreRuntimeCore(e)));(0,u.useEffect)((()=>{t.setAdapter(e)}));const{modelContext:r}=(0,p.useRuntimeAdapters)()??{};return(0,u.useEffect)((()=>{if(r)return t.registerModelContextProvider(r)}),[r,t]),(0,u.useMemo)((()=>new d.AssistantRuntimeImpl(t)),[t])}},39033:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c=(e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let c of a(t))i.call(e,c)||c===r||o(e,c,{get:()=>t[c],enumerable:!(s=n(t,c))||s.enumerable});return e},u=(e,t,r)=>(c(e,t,"default"),r&&c(r,t,"default")),l={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(l,{ExportedMessageRepository:()=>d.ExportedMessageRepository}),e.exports=(s=l,c(o({},"__esModule",{value:!0}),s)),u(l,r(87387),e.exports),u(l,r(83969),e.exports),u(l,r(5663),e.exports),u(l,r(21306),e.exports),u(l,r(9717),e.exports),u(l,r(23328),e.exports),u(l,r(10837),e.exports);var d=r(94533)},45159:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{LocalRuntimeCore:()=>h}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(32551),l=r(35028),d=r(29823),p=r(94533),h=class extends u.BaseAssistantRuntimeCore{threads;Provider=void 0;_options;constructor(e,t){super(),this._options=e,this.threads=new d.LocalThreadListRuntimeCore((()=>new l.LocalThreadRuntimeCore(this._contextProvider,this._options))),t&&this.threads.getMainThreadRuntimeCore().import(p.ExportedMessageRepository.fromArray(t))}}},99628:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};((e,t)=>{for(var s in t)r(e,s,{get:t[s],enumerable:!0})})(a,{splitLocalRuntimeOptions:()=>i}),e.exports=(t=a,((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t));var i=e=>{const{cloud:t,initialMessages:r,maxSteps:s,adapters:o,unstable_humanToolNames:n,...a}=e;return{localRuntimeOptions:{cloud:t,initialMessages:r,maxSteps:s,adapters:o,unstable_humanToolNames:n},otherOptions:a}}},29823:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{LocalThreadListRuntimeCore:()=>d}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(19162),l=Object.freeze([]),d=class extends u.BaseSubscribable{_mainThread;constructor(e){super(),this._mainThread=e()}getMainThreadRuntimeCore(){return this._mainThread}get newThreadId(){throw new Error("Method not implemented.")}get threadIds(){throw l}get archivedThreadIds(){throw l}get mainThreadId(){return"__DEFAULT_ID__"}getThreadRuntimeCore(){throw new Error("Method not implemented.")}getLoadThreadsPromise(){throw new Error("Method not implemented.")}getItemById(e){if(e===this.mainThreadId)return{status:"regular",threadId:this.mainThreadId,remoteId:this.mainThreadId,externalId:void 0,title:void 0,isMain:!0};throw new Error("Method not implemented")}async switchToThread(){throw new Error("Method not implemented.")}switchToNewThread(){throw new Error("Method not implemented.")}rename(){throw new Error("Method not implemented.")}archive(){throw new Error("Method not implemented.")}unarchive(){throw new Error("Method not implemented.")}delete(){throw new Error("Method not implemented.")}initialize(){throw new Error("Method not implemented.")}generateTitle(){throw new Error("Method not implemented.")}}},35028:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{LocalThreadRuntimeCore:()=>h}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(51764),l=r(21306),d=r(3176),p=r(84382),h=class extends p.BaseThreadRuntimeCore{capabilities={switchToBranch:!0,edit:!0,reload:!0,cancel:!0,unstable_copy:!0,speech:!1,attachments:!1,feedback:!1};abortController=null;isDisabled=!1;_suggestions=[];_suggestionsController=null;get suggestions(){return this._suggestions}get adapters(){return this._options.adapters}constructor(e,t){super(e),this.__internal_setOptions(t)}_options;_lastRunConfig={};get extras(){}__internal_setOptions(e){if(this._options===e)return;this._options=e;let t=!1;const r=void 0!==e.adapters?.speech;this.capabilities.speech!==r&&(this.capabilities.speech=r,t=!0);const s=void 0!==e.adapters?.attachments;this.capabilities.attachments!==s&&(this.capabilities.attachments=s,t=!0);const o=void 0!==e.adapters?.feedback;this.capabilities.feedback!==o&&(this.capabilities.feedback=o,t=!0),t&&this._notifySubscribers()}_loadPromise;__internal_load(){if(this._loadPromise)return this._loadPromise;const e=this.adapters.history?.load()??Promise.resolve(null);return this._loadPromise=e.then((e=>{if(!e)return;this.repository.import(e),this._notifySubscribers();const t=this.adapters.history?.resume?.bind(this.adapters.history);e.unstable_resume&&t&&this.startRun({parentId:this.repository.headId,sourceId:this.repository.headId,runConfig:this._lastRunConfig},t)})),this._loadPromise}async append(e){this.ensureInitialized();const t=(0,l.fromCoreMessage)(e,{attachments:e.attachments});this.repository.addOrUpdateMessage(e.parentId,t),this._options.adapters.history?.append({parentId:e.parentId,message:t}),e.startRun??"user"===e.role?await this.startRun({parentId:t.id,sourceId:e.sourceId,runConfig:e.runConfig??{}}):(this.repository.resetHead(t.id),this._notifySubscribers())}resumeRun({stream:e,...t}){return this.startRun(t,e)}async startRun({parentId:e,runConfig:t},r){this.ensureInitialized(),this.repository.resetHead(e);let s={id:(0,u.generateId)(),role:"assistant",status:{type:"running"},content:[],metadata:{unstable_annotations:[],unstable_data:[],steps:[],custom:{}},createdAt:new Date};this._notifyEventSubscribers("run-start");try{this._suggestions=[],this._suggestionsController?.abort(),this._suggestionsController=null;do{s=await this.performRoundtrip(e,s,t,r),r=void 0}while((0,d.shouldContinue)(s,this._options.unstable_humanToolNames))}finally{this._notifyEventSubscribers("run-end")}this._suggestionsController=new AbortController;const o=this._suggestionsController.signal;if(this.adapters.suggestion&&"requires-action"!==s.status?.type){const e=this.adapters.suggestion?.generate({messages:this.messages});if(Symbol.asyncIterator in e)for await(const t of e){if(o.aborted)break;this._suggestions=t}else{const t=await e;if(o.aborted)return;this._suggestions=t}}}async performRoundtrip(e,t,r,s){const o=this.repository.getMessages();this.abortController?.abort(),this.abortController=new AbortController;const n=t.content,a=t.metadata?.unstable_annotations,i=t.metadata?.unstable_data,c=t.metadata?.steps,u=t.metadata?.custom,l=r=>{const s=r.metadata?.steps,o=s?[...c??[],...s]:void 0,l=r.metadata?.unstable_annotations,d=r.metadata?.unstable_data,p=l?[...a??[],...l]:void 0,h=d?[...i??[],...d]:void 0;t={...t,...r.content?{content:[...n,...r.content??[]]}:void 0,status:r.status??t.status,...r.metadata?{metadata:{...t.metadata,...p?{unstable_annotations:p}:void 0,...h?{unstable_data:h}:void 0,...o?{steps:o}:void 0,...r.metadata?.custom?{custom:{...u??{},...r.metadata.custom}}:void 0}}:void 0},this.repository.addOrUpdateMessage(e,t),this._notifySubscribers()},d=this._options.maxSteps??2;if((t.metadata?.steps?.length??0)>=d)return l({status:{type:"incomplete",reason:"tool-calls"}}),t;l({status:{type:"running"}});try{this._lastRunConfig=r??{};const e=this.getModelContext(),n=(s=s??this.adapters.chatModel.run.bind(this.adapters.chatModel))({messages:o,runConfig:this._lastRunConfig,abortSignal:this.abortController.signal,context:e,config:e,unstable_assistantMessageId:t.id,unstable_getMessage:()=>t});if(Symbol.asyncIterator in n)for await(const e of n)l(e);else l(await n);this.abortController=null,"running"===t.status.type&&l({status:{type:"complete",reason:"unknown"}})}catch(e){if(this.abortController=null,!(e instanceof Error&&"AbortError"===e.name))throw l({status:{type:"incomplete",reason:"error",error:e instanceof Error?e.message:`[${typeof e}] ${new String(e).toString()}`}}),e;l({status:{type:"incomplete",reason:"cancelled"}})}finally{"complete"!==t.status.type&&"incomplete"!==t.status.type||await(this._options.adapters.history?.append({parentId:e,message:t}))}return t}cancelRun(){this.abortController?.abort(),this.abortController=null}addToolResult({messageId:e,toolCallId:t,result:r}){const s=this.repository.getMessage(e),{parentId:o}=s;let{message:n}=s;if("assistant"!==n.role)throw new Error("Tried to add tool result to non-assistant message");let a=!1,i=!1;const c=n.content.map((e=>"tool-call"!==e.type||e.toolCallId!==t?e:(i=!0,e.result||(a=!0),{...e,result:r})));if(!i)throw new Error("Tried to add tool result to non-existing tool call");n={...n,content:c},this.repository.addOrUpdateMessage(o,n),a&&(0,d.shouldContinue)(n,this._options.unstable_humanToolNames)&&this.performRoundtrip(o,n,this._lastRunConfig)}}},23328:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{useLocalRuntime:()=>u.useLocalRuntime}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(65655)},3176:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};((e,t)=>{for(var s in t)r(e,s,{get:t[s],enumerable:!0})})(a,{shouldContinue:()=>i}),e.exports=(t=a,((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t));var i=(e,t)=>void 0===t?"requires-action"===e.status?.type&&"tool-calls"===e.status.reason&&e.content.every((e=>"tool-call"!==e.type||!!e.result)):"requires-action"===e.status?.type&&"tool-calls"===e.status.reason&&e.content.every((e=>"tool-call"!==e.type||!!e.result||!t.includes(e.toolName)))},65655:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{useLocalRuntime:()=>f}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(7509),l=r(45159),d=r(38952),p=r(7763),h=r(65848),m=r(51764),f=(e,{cloud:t,...r}={})=>{const s=(0,h.useCloudThreadListAdapter)({cloud:t});return(0,p.useRemoteThreadListRuntime)({runtimeHook:function(){return((e,{initialMessages:t,...r})=>{const{modelContext:s,...o}=(0,d.useRuntimeAdapters)()??{},n=(0,u.useMemo)((()=>({...r,adapters:{...o,...r.adapters,chatModel:e}})),[e,r,o]),[a]=(0,u.useState)((()=>new l.LocalRuntimeCore(n,t)));return(0,u.useEffect)((()=>{a.threads.getMainThreadRuntimeCore().__internal_setOptions(n),a.threads.getMainThreadRuntimeCore().__internal_load()}),[a,n]),(0,u.useEffect)((()=>{if(s)return a.registerModelContextProvider(s)}),[s,a]),(0,u.useMemo)((()=>new m.AssistantRuntimeImpl(a)),[a])})(e,r)},adapter:s})}},19162:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};((e,t)=>{for(var s in t)r(e,s,{get:t[s],enumerable:!0})})(a,{BaseSubscribable:()=>i}),e.exports=(t=a,((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t));var i=class{_subscribers=new Set;subscribe(e){return this._subscribers.add(e),()=>this._subscribers.delete(e)}waitForUpdate(){return new Promise((e=>{const t=this.subscribe((()=>{t(),e()}))}))}_notifySubscribers(){const e=[];for(const t of this._subscribers)try{t()}catch(t){e.push(t)}if(e.length>0)throw 1===e.length?e[0]:new AggregateError(e)}}},84773:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};((e,t)=>{for(var s in t)r(e,s,{get:t[s],enumerable:!0})})(a,{EMPTY_THREAD_CORE:()=>c}),e.exports=(t=a,((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t));var i=new Error("This is the empty thread, a placeholder for the main thread. You cannot perform any actions on this thread instance. This error is probably because you tried to call a thread method in your render function. Call the method inside a `useEffect` hook instead."),c={getMessageById(){},getBranches:()=>[],switchToBranch(){throw i},append(){throw i},startRun(){throw i},resumeRun(){throw i},cancelRun(){throw i},addToolResult(){throw i},speak(){throw i},stopSpeaking(){throw i},getSubmittedFeedback(){},submitFeedback(){throw i},getModelContext:()=>({}),composer:{attachments:[],getAttachmentAccept:()=>"*",async addAttachment(){throw i},async removeAttachment(){throw i},isEditing:!1,canCancel:!1,isEmpty:!0,text:"",setText(){throw i},role:"user",setRole(){throw i},runConfig:{},setRunConfig(){throw i},async reset(){},async clearAttachments(){},send(){throw i},cancel(){},subscribe:()=>()=>{},unstable_on:()=>()=>{}},getEditComposer(){},beginEdit(){throw i},speech:void 0,capabilities:{switchToBranch:!1,edit:!1,reload:!1,cancel:!1,unstable_copy:!1,speech:!1,attachments:!1,feedback:!1},isDisabled:!0,messages:[],suggestions:[],extras:void 0,subscribe:()=>()=>{},import(){throw i},export:()=>({messages:[]}),unstable_on:()=>()=>{}}},70057:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{OptimisticState:()=>d}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(19162),l=(e,t,r)=>r.reduce(((e,r)=>r?.(e,t)??e),e),d=class extends u.BaseSubscribable{_pendingTransforms=[];_baseValue;_cachedValue;constructor(e){super(),this._baseValue=e,this._cachedValue=e}_updateState(){this._cachedValue=this._pendingTransforms.reduce(((e,t)=>l(e,t.task,[t.loading,t.optimistic])),this._baseValue),this._notifySubscribers()}get baseValue(){return this._baseValue}get value(){return this._cachedValue}update(e){this._baseValue=e,this._updateState()}async optimisticUpdate(e){const t=e.execute(),r={...e,task:t};try{this._pendingTransforms.push(r),this._updateState();const s=await t;return this._baseValue=l(this._baseValue,s,[e.optimistic,e.then]),s}finally{const e=this._pendingTransforms.indexOf(r);e>-1&&this._pendingTransforms.splice(e,1),this._updateState()}}}},27189:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{RemoteThreadListHookInstanceManager:()=>g}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(7509),l=r(10661),d=r(76065),p=r(18491),h=r(15571),m=r(19162),f=r(33823),g=class extends m.BaseSubscribable{useRuntimeHook;instances=new Map;useAliveThreadsKeysChanged=(0,l.create)((()=>({})));constructor(e){super(),this.useRuntimeHook=(0,l.create)((()=>({useRuntime:e})))}startThreadRuntime(e){return this.instances.has(e)||(this.instances.set(e,{}),this.useAliveThreadsKeysChanged.setState({},!0)),new Promise(((t,r)=>{const s=()=>{const s=this.instances.get(e);if(s){if(!s.runtime)return;o(),t(s.runtime)}else o(),r(new Error("Thread was deleted before runtime was started"))},o=this.subscribe(s);s()}))}getThreadRuntimeCore(e){const t=this.instances.get(e);if(!t)throw new Error("getThreadRuntimeCore not found. This is a bug in assistant-ui.");return t.runtime}stopThreadRuntime(e){this.instances.delete(e),this.useAliveThreadsKeysChanged.setState({},!0)}setRuntimeHook(e){this.useRuntimeHook.getState().useRuntime!==e&&this.useRuntimeHook.setState({useRuntime:e},!0)}_InnerActiveThreadProvider=()=>{const{id:e}=(0,h.useThreadListItem)(),{useRuntime:t}=this.useRuntimeHook(),r=t(),s=r.thread.__internal_threadBinding,o=(0,u.useCallback)((()=>{const t=this.instances.get(e);if(!t)throw new Error("Thread not found. This is a bug in assistant-ui.");t.runtime=s.getState(),n&&this._notifySubscribers()}),[e,s]),n=(0,u.useRef)(!1);n.current||o(),(0,u.useEffect)((()=>(n.current=!0,o(),s.outerSubscribe(o))),[s,o]);const a=(0,h.useThreadListItemRuntime)();return(0,u.useEffect)((()=>r.threads.main.unstable_on("initialize",(()=>{if("new"===a.getState().status){a.initialize();const e=r.thread.unstable_on("run-end",(()=>{e(),a.generateTitle()}))}}))),[r,a]),null};_OuterActiveThreadProvider=(0,u.memo)((({threadId:e,provider:t})=>{const r=(0,d.useAssistantRuntime)(),s=(0,u.useMemo)((()=>r.threads.getItemById(e)),[r,e]);return(0,f.jsx)(p.ThreadListItemRuntimeProvider,{runtime:s,children:(0,f.jsx)(t,{children:(0,f.jsx)(this._InnerActiveThreadProvider,{})})})}));__internal_RenderThreadRuntimes=({provider:e})=>(this.useAliveThreadsKeysChanged(),Array.from(this.instances.keys()).map((t=>(0,f.jsx)(this._OuterActiveThreadProvider,{threadId:t,provider:e},t))))}},87996:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{RemoteThreadListThreadListRuntimeCore:()=>v}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(51764),l=r(27189),d=r(19162),p=r(84773),h=r(70057),m=r(7509),f=r(10661),g=r(29158),b=r(38952),y=r(33823),O=(e,t)=>{const r=e.threadIdMap[t];if(void 0!==r)return e.threadData[r]},w=(e,t,r)=>{const s=O(e,t);if(!s)return e;const{threadId:o,remoteId:n,status:a}=s;if(a===r)return e;const i={...e};switch(a){case"new":i.newThreadId=void 0;break;case"regular":i.threadIds=i.threadIds.filter((e=>e!==o));break;case"archived":i.archivedThreadIds=i.archivedThreadIds.filter((e=>e!==o));break;default:throw new Error(`Unsupported state: ${a}`)}switch(r){case"regular":i.threadIds=[o,...i.threadIds];break;case"archived":i.archivedThreadIds=[o,...i.archivedThreadIds];break;case"deleted":i.threadData=Object.fromEntries(Object.entries(i.threadData).filter((([e])=>e!==o))),i.threadIdMap=Object.fromEntries(Object.entries(i.threadIdMap).filter((([e])=>e!==o&&e!==n)));break;default:throw new Error(`Unsupported state: ${r}`)}return"deleted"!==r&&(i.threadData={...i.threadData,[o]:{...s,status:r}}),i},v=class extends d.BaseSubscribable{constructor(e,t){super(),this.contextProvider=t,this._state.subscribe((()=>this._notifySubscribers())),this._hookManager=new l.RemoteThreadListHookInstanceManager(e.runtimeHook),this.useProvider=(0,f.create)((()=>({Provider:e.adapter.unstable_Provider??m.Fragment}))),this.__internal_setOptions(e),this.switchToNewThread()}_options;_hookManager;_loadThreadsPromise;_mainThreadId;_state=new h.OptimisticState({isLoading:!1,newThreadId:void 0,threadIds:[],archivedThreadIds:[],threadIdMap:{},threadData:{}});getLoadThreadsPromise(){return this._loadThreadsPromise||(this._loadThreadsPromise=this._state.optimisticUpdate({execute:()=>this._options.adapter.list(),loading:e=>({...e,isLoading:!0}),then:(e,t)=>{const r=[],s=[],o={},n={};for(const e of t.threads){switch(e.status){case"regular":r.push(e.remoteId);break;case"archived":s.push(e.remoteId);break;default:{const t=e.status;throw new Error(`Unsupported state: ${t}`)}}const t=e.remoteId;o[e.remoteId]=t,n[t]={threadId:e.remoteId,remoteId:e.remoteId,externalId:e.externalId,status:e.status,title:e.title,initializeTask:Promise.resolve({remoteId:e.remoteId,externalId:e.externalId})}}return{...e,threadIds:r,archivedThreadIds:s,threadIdMap:{...e.threadIdMap,...o},threadData:{...e.threadData,...n}}}}).then((()=>{}))),this._loadThreadsPromise}useProvider;__internal_setOptions(e){if(this._options===e)return;this._options=e;const t=e.adapter.unstable_Provider??m.Fragment;t!==this.useProvider.getState().Provider&&this.useProvider.setState({Provider:t},!0),this._hookManager.setRuntimeHook(e.runtimeHook)}__internal_load(){this.getLoadThreadsPromise()}get threadIds(){return this._state.value.threadIds}get archivedThreadIds(){return this._state.value.archivedThreadIds}get newThreadId(){return this._state.value.newThreadId}get mainThreadId(){return this._mainThreadId}getMainThreadRuntimeCore(){return this._hookManager.getThreadRuntimeCore(this._mainThreadId)||p.EMPTY_THREAD_CORE}getThreadRuntimeCore(e){const t=this.getItemById(e);if(!t)throw new Error("Thread not found");const r=this._hookManager.getThreadRuntimeCore(t.threadId);if(!r)throw new Error("Thread not found");return r}getItemById(e){return O(this._state.value,e)}async switchToThread(e){const t=this.getItemById(e);if(!t)throw new Error("Thread not found");if(this._mainThreadId===t.threadId)return;const r=this._hookManager.startThreadRuntime(t.threadId);void 0!==this.mainThreadId?await r:r.then((()=>this._notifySubscribers())),"archived"===t.status&&await this.unarchive(t.threadId),this._mainThreadId=t.threadId,this._notifySubscribers()}async switchToNewThread(){for(;void 0!==this._state.baseValue.newThreadId&&void 0===this._state.value.newThreadId;)await this._state.waitForUpdate();const e=this._state.value;let t=this._state.value.newThreadId;if(void 0===t){do{t=`__LOCALID_${(0,u.generateId)()}`}while(e.threadIdMap[t]);const r=t;this._state.update({...e,newThreadId:t,threadIdMap:{...e.threadIdMap,[t]:r},threadData:{...e.threadData,[t]:{status:"new",threadId:t}}})}return this.switchToThread(t)}initialize=async e=>{if(this._state.value.newThreadId!==e){const t=this.getItemById(e);if(!t)throw new Error("Thread not found");if("new"===t.status)throw new Error("Unexpected new state");return t.initializeTask}return this._state.optimisticUpdate({execute:()=>this._options.adapter.initialize(e),optimistic:t=>w(t,e,"regular"),loading:(t,r)=>{const s=e;return{...t,threadData:{...t.threadData,[s]:{...t.threadData[s],initializeTask:r}}}},then:(t,{remoteId:r,externalId:s})=>{const o=O(t,e);if(!o)return t;const n=e;return{...t,threadIdMap:{...t.threadIdMap,[r]:n},threadData:{...t.threadData,[n]:{...o,initializeTask:Promise.resolve({remoteId:r,externalId:s}),remoteId:r,externalId:s}}}}})};generateTitle=async e=>{const t=this.getItemById(e);if(!t)throw new Error("Thread not found");if("new"===t.status)throw new Error("Thread is not yet initialized");const{remoteId:r}=await t.initializeTask,s=this.getThreadRuntimeCore(e).messages,o=await this._options.adapter.generateTitle(r,s),n=g.AssistantMessageStream.fromAssistantStream(o);for await(const e of n){const r=e.parts.filter((e=>"text"===e.type))[0]?.text??"New Thread",s=this._state.baseValue;this._state.update({...s,threadData:{...s.threadData,[t.threadId]:{...t,title:r}}})}};rename(e,t){const r=this.getItemById(e);if(!r)throw new Error("Thread not found");if("new"===r.status)throw new Error("Thread is not yet initialized");return this._state.optimisticUpdate({execute:async()=>{const{remoteId:e}=await r.initializeTask;return this._options.adapter.rename(e,t)},optimistic:r=>{const s=O(r,e);return s?{...r,threadData:{...r.threadData,[s.threadId]:{...s,title:t}}}:r}})}async _ensureThreadIsNotMain(e){e===this._mainThreadId&&await this.switchToNewThread()}async archive(e){const t=this.getItemById(e);if(!t)throw new Error("Thread not found");if("regular"!==t.status)throw new Error("Thread is not yet initialized or already archived");return this._state.optimisticUpdate({execute:async()=>{await this._ensureThreadIsNotMain(t.threadId);const{remoteId:e}=await t.initializeTask;return this._options.adapter.archive(e)},optimistic:e=>w(e,t.threadId,"archived")})}unarchive(e){const t=this.getItemById(e);if(!t)throw new Error("Thread not found");if("archived"!==t.status)throw new Error("Thread is not archived");return this._state.optimisticUpdate({execute:async()=>{try{const{remoteId:e}=await t.initializeTask;return await this._options.adapter.unarchive(e)}catch(e){throw await this._ensureThreadIsNotMain(t.threadId),e}},optimistic:e=>w(e,t.threadId,"regular")})}async delete(e){const t=this.getItemById(e);if(!t)throw new Error("Thread not found");if("regular"!==t.status&&"archived"!==t.status)throw new Error("Thread is not yet initialized");return this._state.optimisticUpdate({execute:async()=>{await this._ensureThreadIsNotMain(t.threadId);const{remoteId:e}=await t.initializeTask;return await this._options.adapter.delete(e)},optimistic:e=>w(e,t.threadId,"deleted")})}useBoundIds=(0,f.create)((()=>[]));__internal_RenderComponent=()=>{const e=(0,m.useId)();(0,m.useEffect)((()=>(this.useBoundIds.setState((t=>[...t,e]),!0),()=>{this.useBoundIds.setState((t=>t.filter((t=>t!==e))),!0)})),[e]);const t=this.useBoundIds(),{Provider:r}=this.useProvider(),s={modelContext:this.contextProvider};return(0===t.length||t[0]===e)&&(0,y.jsx)(b.RuntimeAdapterProvider,{adapters:s,children:(0,y.jsx)(this._hookManager.__internal_RenderThreadRuntimes,{provider:r})})}}},65848:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{useCloudThreadListAdapter:()=>y}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(7509),l=r(38126),d=r(13667),p=r(38952),h=r(21306),m=r(85688),f=r(33823),g="undefined"!=typeof process&&process?.env?.NEXT_PUBLIC_ASSISTANT_BASE_URL,b=g?new l.AssistantCloud({baseUrl:g,anonymous:!0}):void 0,y=e=>{const t=(0,u.useRef)(e);(0,u.useEffect)((()=>{t.current=e}),[e]);const r=(0,u.useCallback)((function({children:e}){const r=(0,d.useAssistantCloudThreadHistoryAdapter)({get current(){return t.current.cloud??b}}),s=(0,u.useMemo)((()=>({history:r})),[r]);return(0,f.jsx)(p.RuntimeAdapterProvider,{adapters:s,children:e})}),[]),s=e.cloud??b;return s?{list:async()=>{const{threads:e}=await s.threads.list();return{threads:e.map((e=>({status:e.is_archived?"archived":"regular",remoteId:e.id,title:e.title,externalId:e.external_id??void 0})))}},initialize:async()=>{const t=e.create?.()??Promise.resolve(),r=await t,o=r?r.externalId:void 0,{thread_id:n}=await s.threads.create({last_message_at:new Date,external_id:o});return{externalId:o,remoteId:n}},rename:async(e,t)=>s.threads.update(e,{title:t}),archive:async e=>s.threads.update(e,{is_archived:!0}),unarchive:async e=>s.threads.update(e,{is_archived:!1}),delete:async t=>(await(e.delete?.(t)),s.threads.delete(t)),generateTitle:async(e,t)=>s.runs.stream({thread_id:e,assistant_id:"system/thread_title",messages:(0,h.toCoreMessages)(t)}),unstable_Provider:r}:new m.InMemoryThreadListAdapter}},85688:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};((e,t)=>{for(var s in t)r(e,s,{get:t[s],enumerable:!0})})(a,{InMemoryThreadListAdapter:()=>i}),e.exports=(t=a,((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t));var i=class{list(){return Promise.resolve({threads:[]})}rename(){return Promise.resolve()}archive(){return Promise.resolve()}unarchive(){return Promise.resolve()}delete(){return Promise.resolve()}initialize(e){return Promise.resolve({remoteId:e,externalId:void 0})}generateTitle(){return Promise.resolve(new ReadableStream)}}},10837:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{unstable_InMemoryThreadListAdapter:()=>l.InMemoryThreadListAdapter,unstable_useRemoteThreadListRuntime:()=>u.useRemoteThreadListRuntime}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(7763),l=r(85688)},7763:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{useRemoteThreadListRuntime:()=>m}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(7509),l=r(32551),d=r(87996),p=r(51764),h=class extends l.BaseAssistantRuntimeCore{threads;constructor(e){super(),this.threads=new d.RemoteThreadListThreadListRuntimeCore(e,this._contextProvider)}get RenderComponent(){return this.threads.__internal_RenderComponent}},m=e=>{const[t]=(0,u.useState)((()=>new h(e)));return(0,u.useEffect)((()=>{t.threads.__internal_setOptions(e),t.threads.__internal_load()}),[t,e]),(0,u.useMemo)((()=>new p.AssistantRuntimeImpl(t)),[t])}},94533:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{ExportedMessageRepository:()=>h,MessageRepository:()=>g}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(93511),l=r(99981),d=r(89549),p=r(89129),h={fromArray:e=>{const t=e.map((e=>(0,p.fromThreadMessageLike)(e,(0,u.generateId)(),(0,d.getAutoStatus)(!1,!1))));return{messages:t.map(((e,r)=>({parentId:r>0?t[r-1].id:null,message:e})))}}},m=e=>e.next?m(e.next):"current"in e?e:null,f=class{constructor(e){this.func=e}_value=null;get value(){return null===this._value&&(this._value=this.func()),this._value}dirty(){this._value=null}},g=class{messages=new Map;head=null;root={children:[],next:null};performOp(e,t,r){const s=t.prev??this.root,o=e??this.root;if("relink"!==r||s!==o){if("link"!==r&&(s.children=s.children.filter((e=>e!==t.current.id)),s.next===t)){const e=s.children.at(-1),t=e?this.messages.get(e):null;if(void 0===t)throw new Error("MessageRepository(performOp/cut): Fallback sibling message not found. This is likely an internal bug in assistant-ui.");s.next=t}if("cut"!==r){for(let r=e;r;r=r.prev)if(r.current.id===t.current.id)throw new Error("MessageRepository(performOp/link): A message with the same id already exists in the parent tree. This error occurs if the same message id is found multiple times. This is likely an internal bug in assistant-ui.");o.children=[...o.children,t.current.id],m(t)!==this.head&&null!==o.next||(o.next=t),t.prev=e}}}_messages=new f((()=>{const e=new Array(this.head?.level??0);for(let t=this.head;t;t=t.prev)e[t.level]=t.current;return e}));get headId(){return this.head?.current.id??null}getMessages(){return this._messages.value}addOrUpdateMessage(e,t){const r=this.messages.get(t.id),s=e?this.messages.get(e):null;if(void 0===s)throw new Error("MessageRepository(addOrUpdateMessage): Parent message not found. This is likely an internal bug in assistant-ui.");if(r)return r.current=t,this.performOp(s,r,"relink"),void this._messages.dirty();const o={prev:s,current:t,next:null,children:[],level:s?s.level+1:0};this.messages.set(t.id,o),this.performOp(s,o,"link"),this.head===s&&(this.head=o),this._messages.dirty()}getMessage(e){const t=this.messages.get(e);if(!t)throw new Error("MessageRepository(updateMessage): Message not found. This is likely an internal bug in assistant-ui.");return{parentId:t.prev?.current.id??null,message:t.current}}appendOptimisticMessage(e,t){let r;do{r=(0,u.generateOptimisticId)()}while(this.messages.has(r));return this.addOrUpdateMessage(e,(0,l.fromCoreMessage)(t,{id:r,status:{type:"running"}})),r}deleteMessage(e,t){const r=this.messages.get(e);if(!r)throw new Error("MessageRepository(deleteMessage): Optimistic message not found. This is likely an internal bug in assistant-ui.");const s=void 0===t?r.prev:null===t?null:this.messages.get(t);if(void 0===s)throw new Error("MessageRepository(deleteMessage): Replacement not found. This is likely an internal bug in assistant-ui.");for(const e of r.children){const t=this.messages.get(e);if(!t)throw new Error("MessageRepository(deleteMessage): Child message not found. This is likely an internal bug in assistant-ui.");this.performOp(s,t,"relink")}this.performOp(null,r,"cut"),this.messages.delete(e),this.head===r&&(this.head=m(s??this.root)),this._messages.dirty()}getBranches(e){const t=this.messages.get(e);if(!t)throw new Error("MessageRepository(getBranches): Message not found. This is likely an internal bug in assistant-ui.");const{children:r}=t.prev??this.root;return r}switchToBranch(e){const t=this.messages.get(e);if(!t)throw new Error("MessageRepository(switchToBranch): Branch not found. This is likely an internal bug in assistant-ui.");(t.prev??this.root).next=t,this.head=m(t),this._messages.dirty()}resetHead(e){if(null===e)return this.head=null,void this._messages.dirty();const t=this.messages.get(e);if(!t)throw new Error("MessageRepository(resetHead): Branch not found. This is likely an internal bug in assistant-ui.");this.head=t;for(let e=t;e;e=e.prev)e.prev&&(e.prev.next=e);this._messages.dirty()}clear(){this.messages.clear(),this.head=null,this.root={children:[],next:null},this._messages.dirty()}export(){const e=[];for(const[,t]of this.messages)e.push({message:t.current,parentId:t.prev?.current.id??null});return{headId:this.head?.current.id??null,messages:e}}import({headId:e,messages:t}){for(const{message:e,parentId:r}of t)this.addOrUpdateMessage(r,e);this.resetHead(e??t.at(-1)?.message.id??null)}}},99820:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty;e.exports=(t={},((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t))},76614:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{CompositeContextProvider:()=>l}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(40387),l=class{_providers=new Set;getModelContext(){return(0,u.mergeModelContexts)(this._providers)}registerModelContextProvider(e){this._providers.add(e);const t=e.subscribe?.((()=>{this.notifySubscribers()}));return this.notifySubscribers(),()=>{this._providers.delete(e),t?.(),this.notifySubscribers()}}_subscribers=new Set;notifySubscribers(){for(const e of this._subscribers)e()}subscribe(e){return this._subscribers.add(e),()=>this._subscribers.delete(e)}}},75086:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{createCombinedStore:()=>l}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(7509),l=e=>{const t=t=>{const r=e.map((e=>e.subscribe(t)));return()=>{for(const e of r)e()}};return r=>{const s=()=>r(...e.map((e=>e.getState())));return(0,u.useSyncExternalStore)(t,s,s)}}},24967:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{useCombinedStore:()=>d}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(7509),l=r(75086),d=(e,t)=>(0,u.useMemo)((()=>(0,l.createCombinedStore)(e)),e)(t)},93187:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{createActionButton:()=>h}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(7509),l=r(37767),d=r(60415),p=r(33823),h=(e,t,r=[])=>{const s=(0,u.forwardRef)(((e,s)=>{const o={},n={};Object.keys(e).forEach((t=>{r.includes(t)?o[t]=e[t]:n[t]=e[t]}));const a=t(o)??void 0;return(0,p.jsx)(l.Primitive.button,{type:"button",...n,ref:s,disabled:n.disabled||!a,onClick:(0,d.composeEventHandlers)(n.onClick,a)})}));return s.displayName=e,s}},87153:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};((e,t)=>{for(var s in t)r(e,s,{get:t[s],enumerable:!0})})(a,{getThreadMessageText:()=>i}),e.exports=(t=a,((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t));var i=e=>e.content.filter((e=>"text"===e.type)).map((e=>e.text)).join("\n\n")},48714:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{useManagedRef:()=>l}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(7509),l=e=>{const t=(0,u.useRef)(void 0);return(0,u.useCallback)((r=>{t.current&&t.current(),r&&(t.current=e(r))}),[e])}},181:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{useOnResizeContent:()=>p}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(88299),l=r(7509),d=r(48714),p=e=>{const t=(0,u.useCallbackRef)(e),r=(0,l.useCallback)((e=>{const r=new ResizeObserver((()=>{t()})),s=new MutationObserver((()=>{t()}));return r.observe(e),s.observe(e,{childList:!0,subtree:!0,attributes:!0,characterData:!0}),()=>{r.disconnect(),s.disconnect()}}),[t]);return(0,d.useManagedRef)(r)}},74801:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{useOnScrollToBottom:()=>p}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(88299),l=r(7509),d=r(89429),p=e=>{const t=(0,u.useCallbackRef)(e),r=(0,d.useThreadViewport)((e=>e.onScrollToBottom));(0,l.useEffect)((()=>r(t)),[r,t])}},93511:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{generateId:()=>u,generateOptimisticId:()=>d,isOptimisticId:()=>p}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=(0,r(81869).customAlphabet)("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7),l="__optimistic__",d=()=>`${l}${u()}`,p=e=>e.startsWith(l)},5181:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};function i(e){const t=["ROOT"];let r=-1,s=null;function o(e,o,n){switch(e){case'"':r=o,t.pop(),t.push(n),t.push("INSIDE_STRING");break;case"f":case"t":case"n":r=o,s=o,t.pop(),t.push(n),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(n),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=o,t.pop(),t.push(n),t.push("INSIDE_NUMBER");break;case"{":r=o,t.pop(),t.push(n),t.push("INSIDE_OBJECT_START");break;case"[":r=o,t.pop(),t.push(n),t.push("INSIDE_ARRAY_START")}}function n(e,s){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":r=s,t.pop()}}function a(e,s){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=s,t.pop()}}for(let i=0;i<e.length;i++){const c=e[i];switch(t[t.length-1]){case"ROOT":o(c,i,"FINISH");break;case"INSIDE_OBJECT_START":switch(c){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":r=i,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===c&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===c&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===c&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":o(c,i,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":n(c,i);break;case"INSIDE_STRING":switch(c){case'"':t.pop(),r=i;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:r=i}break;case"INSIDE_ARRAY_START":"]"===c?(r=i,t.pop()):(r=i,o(c,i,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(c){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=i,t.pop();break;default:r=i}break;case"INSIDE_ARRAY_AFTER_COMMA":o(c,i,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),r=i;break;case"INSIDE_NUMBER":switch(c){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=i;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&a(c,i),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&n(c,i);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&n(c,i);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&a(c,i);break;default:t.pop()}break;case"INSIDE_LITERAL":{const o=e.substring(s,i+1);"false".startsWith(o)||"true".startsWith(o)||"null".startsWith(o)?r=i:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?n(c,i):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&a(c,i));break}}}let i=e.slice(0,r+1),c=0;for(let r=t.length-1;r>=0;r--)switch(t[r]){case"INSIDE_STRING":i+='"',c++;break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":i+="}",c++;break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":i+="]",c++;break;case"INSIDE_LITERAL":{const t=e.substring(s,e.length);"true".startsWith(t)?i+="true".slice(t.length):"false".startsWith(t)?i+="false".slice(t.length):"null".startsWith(t)&&(i+="null".slice(t.length))}}return[i,c]}((e,t)=>{for(var s in t)r(e,s,{get:t[s],enumerable:!0})})(a,{fixJson:()=>i}),e.exports=(t=a,((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t))},20686:e=>{var t,r=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};function i(e,t=0){return!(t>100)&&(null===e||"string"==typeof e||"boolean"==typeof e||("number"==typeof e?!Number.isNaN(e)&&Number.isFinite(e):Array.isArray(e)?e.every((e=>i(e,t+1))):"object"==typeof e&&Object.entries(e).every((([e,r])=>"string"==typeof e&&i(r,t+1)))))}function c(e){return Array.isArray(e)&&e.every(i)}function u(e){return null!=e&&"object"==typeof e&&Object.entries(e).every((([e,t])=>"string"==typeof e&&i(t)))}((e,t)=>{for(var s in t)r(e,s,{get:t[s],enumerable:!0})})(a,{isJSONArray:()=>c,isJSONObject:()=>u,isJSONValue:()=>i}),e.exports=(t=a,((e,t,a,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))n.call(e,a)||undefined===a||r(e,a,{get:()=>t[a],enumerable:!(i=s(t,a))||i.enumerable});return e})(r({},"__esModule",{value:!0}),t))},62437:(e,t,r)=>{var s,o=Object.create,n=Object.defineProperty,a=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,c=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty,l=(e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let o of i(t))u.call(e,o)||o===r||n(e,o,{get:()=>t[o],enumerable:!(s=a(t,o))||s.enumerable});return e},d={};((e,t)=>{for(var r in t)n(e,r,{get:t[r],enumerable:!0})})(d,{parsePartialJson:()=>g,useToolArgsFieldStatus:()=>O}),e.exports=(s=d,l(n({},"__esModule",{value:!0}),s));var p=((e,t,r)=>(r=null!=e?o(c(e)):{},l(e&&e.__esModule?r:n(r,"default",{value:e,enumerable:!0}),e)))(r(16141)),h=r(5181),m=r(76065),f=Symbol("partial-json-count"),g=e=>{try{return p.default.parse(e)}catch{try{const[t,r]=(0,h.fixJson)(e),s=p.default.parse(t);return s[f]=r,s}catch{return}}},b=Object.freeze({type:"complete"}),y=(e,t,r,s)=>{if(0===r.length)return e;if("object"!=typeof t||null===t)return b;const o=r.at(-1);if(!Object.prototype.hasOwnProperty.call(t,o))return e;const n=Object.keys(t);return n[n.length-1]===o?y(e,t[o],r.slice(0,-1),s-1):b},O=e=>(0,m.useContentPart)((t=>{if("tool-call"!==t.type)throw new Error("not a tool call");return((e,t,r)=>{const s=t[f]??0;if(0===s)return b;const o="requires-action"!==e.type?e:b;return y(o,t,r,s)})(t.status,t.args,e)}))},27675:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{SmoothContextProvider:()=>f,useSmoothStatus:()=>y,useSmoothStatusStore:()=>O,withSmoothContextProvider:()=>g}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(7509),l=r(10661),d=r(34421),p=r(58755),h=r(33823),m=(0,u.createContext)(null),f=({children:e})=>{const t=b({optional:!0}),r=(0,d.useContentPartRuntime)(),[s]=(0,u.useState)((()=>{return e=r.getState().status,{useSmoothStatus:(0,l.create)((()=>e))};var e}));return t?e:(0,h.jsx)(m.Provider,{value:s,children:e})},g=e=>{const t=(0,u.forwardRef)(((t,r)=>(0,h.jsx)(f,{children:(0,h.jsx)(e,{...t,ref:r})})));return t.displayName=e.displayName,t};function b(e){const t=(0,u.useContext)(m);if(!e?.optional&&!t)throw new Error("This component must be used within a SmoothContextProvider.");return t}var{useSmoothStatus:y,useSmoothStatusStore:O}=(0,p.createContextStoreHook)(b,"useSmoothStatus")},80725:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{useSmooth:()=>u.useSmooth,useSmoothStatus:()=>l.useSmoothStatus,withSmoothContextProvider:()=>l.withSmoothContextProvider}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(31337),l=r(27675)},31337:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{useSmooth:()=>g}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of a(t))i.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var u=r(7509),l=r(76065),d=r(88299),p=r(27675),h=r(31475),m=class{constructor(e,t){this.currentText=e,this.setText=t}animationFrameId=null;lastUpdateTime=Date.now();targetText="";start(){null===this.animationFrameId&&(this.lastUpdateTime=Date.now(),this.animate())}stop(){null!==this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}animate=()=>{const e=Date.now();let t=e-this.lastUpdateTime;const r=this.targetText.length-this.currentText.length,s=Math.min(5,250/r);let o=0;for(;t>=s&&o<r;)o++,t-=s;this.animationFrameId=o!==r?requestAnimationFrame(this.animate):null,0!==o&&(this.currentText=this.targetText.slice(0,this.currentText.length+o),this.lastUpdateTime=e-t,this.setText(this.currentText))}},f=Object.freeze({type:"running"}),g=(e,t=!1)=>{const{text:r}=e,s=(0,l.useMessage)({optional:!0,selector:e=>e.id}),o=(0,u.useRef)(s),[n,a]=(0,u.useState)(r),i=(0,p.useSmoothStatusStore)({optional:!0}),c=(0,d.useCallbackRef)((t=>{if(a(t),i){const r=n!==t||"running"===e.status.type?f:e.status;(0,h.writableStore)(i).setState(r,!0)}}));(0,u.useEffect)((()=>{if(i){const t=n!==r||"running"===e.status.type?f:e.status;(0,h.writableStore)(i).setState(t,!0)}}),[i,r,n,e.status]);const[g]=(0,u.useState)(new m(r,c));return(0,u.useEffect)((()=>{if(t){if(o.current!==s||!r.startsWith(g.targetText))return o.current=s,c(r),g.currentText=r,g.targetText=r,void g.stop();g.targetText=r,g.start()}else g.stop()}),[c,g,s,t,r]),(0,u.useEffect)((()=>()=>{g.stop()}),[g]),(0,u.useMemo)((()=>t?{type:"text",text:n,status:r===n?e.status:f}:e),[t,n,e,r])}},39507:(e,t,r)=>{r.r(t),r.d(t,{arrow:()=>_,autoPlacement:()=>O,autoUpdate:()=>s.Me,computePosition:()=>s.oo,detectOverflow:()=>s.US,flip:()=>b,getOverflowAncestors:()=>o.Kx,hide:()=>w,inline:()=>v,limitShift:()=>g,offset:()=>m,platform:()=>s.Jv,shift:()=>f,size:()=>y,useFloating:()=>p});var s=r(51323),o=r(37317),n=r(7509),a=r(10901),i="undefined"!=typeof document?n.useLayoutEffect:function(){};function c(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if("function"==typeof e&&e.toString()===t.toString())return!0;let r,s,o;if(e&&t&&"object"==typeof e){if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(s=r;0!=s--;)if(!c(e[s],t[s]))return!1;return!0}if(o=Object.keys(e),r=o.length,r!==Object.keys(t).length)return!1;for(s=r;0!=s--;)if(!{}.hasOwnProperty.call(t,o[s]))return!1;for(s=r;0!=s--;){const r=o[s];if(!("_owner"===r&&e.$$typeof||c(e[r],t[r])))return!1}return!0}return e!=e&&t!=t}function u(e){return"undefined"==typeof window?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function l(e,t){const r=u(e);return Math.round(t*r)/r}function d(e){const t=n.useRef(e);return i((()=>{t.current=e})),t}function p(e){void 0===e&&(e={});const{placement:t="bottom",strategy:r="absolute",middleware:o=[],platform:p,elements:{reference:h,floating:m}={},transform:f=!0,whileElementsMounted:g,open:b}=e,[y,O]=n.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[w,v]=n.useState(o);c(w,o)||v(o);const[_,j]=n.useState(null),[P,T]=n.useState(null),I=n.useCallback((e=>{e!==S.current&&(S.current=e,j(e))}),[]),x=n.useCallback((e=>{e!==R.current&&(R.current=e,T(e))}),[]),M=h||_,E=m||P,S=n.useRef(null),R=n.useRef(null),C=n.useRef(y),A=null!=g,N=d(g),D=d(p),k=d(b),L=n.useCallback((()=>{if(!S.current||!R.current)return;const e={placement:t,strategy:r,middleware:w};D.current&&(e.platform=D.current),(0,s.oo)(S.current,R.current,e).then((e=>{const t={...e,isPositioned:!1!==k.current};B.current&&!c(C.current,t)&&(C.current=t,a.flushSync((()=>{O(t)})))}))}),[w,t,r,D,k]);i((()=>{!1===b&&C.current.isPositioned&&(C.current.isPositioned=!1,O((e=>({...e,isPositioned:!1}))))}),[b]);const B=n.useRef(!1);i((()=>(B.current=!0,()=>{B.current=!1})),[]),i((()=>{if(M&&(S.current=M),E&&(R.current=E),M&&E){if(N.current)return N.current(M,E,L);L()}}),[M,E,L,N,A]);const U=n.useMemo((()=>({reference:S,floating:R,setReference:I,setFloating:x})),[I,x]),z=n.useMemo((()=>({reference:M,floating:E})),[M,E]),F=n.useMemo((()=>{const e={position:r,left:0,top:0};if(!z.floating)return e;const t=l(z.floating,y.x),s=l(z.floating,y.y);return f?{...e,transform:"translate("+t+"px, "+s+"px)",...u(z.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:t,top:s}}),[r,f,z.floating,y.x,y.y]);return n.useMemo((()=>({...y,update:L,refs:U,elements:z,floatingStyles:F})),[y,L,U,z,F])}const h=e=>({name:"arrow",options:e,fn(t){const{element:r,padding:o}="function"==typeof e?e(t):e;return r&&(n=r,{}.hasOwnProperty.call(n,"current"))?null!=r.current?(0,s.x7)({element:r.current,padding:o}).fn(t):{}:r?(0,s.x7)({element:r,padding:o}).fn(t):{};var n}}),m=(e,t)=>({...(0,s.cv)(e),options:[e,t]}),f=(e,t)=>({...(0,s.uY)(e),options:[e,t]}),g=(e,t)=>({...(0,s.dr)(e),options:[e,t]}),b=(e,t)=>({...(0,s.RR)(e),options:[e,t]}),y=(e,t)=>({...(0,s.dp)(e),options:[e,t]}),O=(e,t)=>({...(0,s.X5)(e),options:[e,t]}),w=(e,t)=>({...(0,s.Cp)(e),options:[e,t]}),v=(e,t)=>({...(0,s.Qo)(e),options:[e,t]}),_=(e,t)=>({...h(e),options:[e,t]})}}]);